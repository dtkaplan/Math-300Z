<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Danny Kaplan">
<meta name="dcterms.date" content="2022-11-04">

<title>Spring 2023 Math 300 Revisions - Math 300R NTI Lesson r (lesson &lt;- 33)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Spring 2023 Math 300 Revisions</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../lessons.html">
 <span class="menu-text">Lessons</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../layout.html">
 <span class="menu-text">Site layout</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../objective-list.html">
 <span class="menu-text">Objectives</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../LC-list.html">
 <span class="menu-text">LCs</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Math 300R NTI Lesson 33</h1>
<p class="subtitle lead">Measuring and accumulating risk</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Danny Kaplan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 4, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<p>33.1. Distinguish between absolute and relative risk and identify when a change in risk is being presented as absolute or relative.</p>
<p>33.2. Calculate and correctly interpret other presentations of differences in risk: population attributable fraction, NTT, odds ratio.</p>
<p>33.3. Interpret effect size as stated in log odds.</p>
</section>
<section id="reading" class="level2">
<h2 class="anchored" data-anchor-id="reading">Reading</h2>
<p>TBD</p>
</section>
<section id="lesson" class="level2">
<h2 class="anchored" data-anchor-id="lesson">Lesson</h2>
<section id="risk" class="level3">
<h3 class="anchored" data-anchor-id="risk">Risk</h3>
<p>Introduce words related to “risk” and try to convert them into seeing a continuum of “risk” to “opportunity,” that is, uncertain outcomes that could be positive or negative. (“Risk reduction,” “volatility,” “gain,” “gambling”).</p>
<p>Each risky outcome is quantified by two numbers: a probability, and a value. It’s easiest to talk about the value measured in dollars, but there of course other scales: “lives (lost or saved),” “years of life,” “happiness,” “satisfaction,” etc. Unfortunately, we don’t have standard numerical scales for these.</p>
<p>(Epidemiologists have a scale for quantifying health outcome: Quality adjusted life years (QALYs) which would take a class session on its own to explain, but which is highly instructive.)</p>
<p>A “loss function” takes as input a possible outcome of an uncertain event and produces as output a value, which we might measure in dollars or QALYs or lives, etc. For the sake of definiteness, denote a loss function as <span class="math inline">\(L(\cal O)\)</span>, where <span class="math inline">\(\cal O\)</span> is an outcome of the uncertain event. In quantifying loss, each possible outcome <span class="math inline">\(\cal O\)</span> is associated with a probability. Let’s call this <span class="math inline">\(p(\cal O)\)</span>. Mathematical philosophers have been arguing since the mid 1600s about what exactly is meant by probability. Don’t expect a resolution to this quandry. For our purposes, it suffices to think about a probability of an outcome in the context of a prediction model, using the tools from <a href="Math300R-Lesson26.html">Lesson 26</a>.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Ice cream sales
</div>
</div>
<div class="callout-body-container callout-body">
<p>To illustrate, imagine the situation of an ice-cream pushcart vendor. If it is cold or rainy, sales will be slight. If it’s beautiful and hot, sales will be high. Help the students construct a plausible “loss” function: sales versus temperature.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Then generalize that into a function with two inputs, say, raininess and temperature. Or even three inputs: day of the week/holiday, raininess and temperature. Whatever the inputs, the output is sales of ice cream.</p>
</div>
</div>
</section>
<section id="simplifying-loss" class="level3">
<h3 class="anchored" data-anchor-id="simplifying-loss">Simplifying loss</h3>
<p>We have two functions that, together, quantify risk. A loss function <span class="math inline">\(L(\cal O\)</span> and a probability function <span class="math inline">\(p(\cal O)\)</span> where <span class="math inline">\(\cal O\)</span> is the uncertain outcome of the event. It’s very common to compose these two functions into a single function: <span class="math inline">\(p(L(\cal O))\)</span>. Imagine <span class="math inline">\(L(\cal O)\)</span> has an output denominated in, say, dollars. The composed function then looks like <span class="math inline">\(p(\$)\)</span>. There may be many different outcomes that lead to the same $ loss, but lumping them together as a single $ outcome gives a function <span class="math inline">\(p(\$)\)</span>. Presented this way, risk measurement is reduced to a single function with a single input, $, and an output in the form of a probability.</p>
</section>
<section id="probability-odds-log-odds" class="level3">
<h3 class="anchored" data-anchor-id="probability-odds-log-odds">Probability, odds, log odds</h3>
<p>The scale generally used for uncertainty is “probability,” a number between 0 and 1. But there are other scales in use and sometimes these have advantages for doing calculations. The two most important are:</p>
<ol type="i">
<li>Odds</li>
<li>Log odds</li>
</ol>
<p>Any probability can be converted to an odds and vice versa. Similarly, log odds can be converted into odds by using exponentiation (or vice versa, by using the logarithm function).</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Odds and gambling
</div>
</div>
<div class="callout-body-container callout-body">
<p>The bookie arranges things so that the money staked by the gamblers is simply redistributed. The winners get back their stake plus the money staked by the losers. The odds given reflect the balance between the winners’ stakes and the losers’ stakes. If $50 is bet on A and $25 on B, then the odds on A will be 1:2. That is, the winners, if A is the outcome, will get $25 plus their stake back. Since their stake was $50, the odds will be 1:2. On the other hand, if B is the outcome, the winners will get $50 plus their stake. This corresponds to odds of 2:1.</p>
</div>
</div>
</section>
<section id="accumulating-loss" class="level3">
<h3 class="anchored" data-anchor-id="accumulating-loss">Accumulating loss</h3>
<p>Provide a situation where there are many “risk factors” for an outcome. Suppose the outcome is disease D and there are risk factors <span class="math inline">\(R_1\)</span>, <span class="math inline">\(R_2\)</span>, <span class="math inline">\(R_3\)</span>, …, say “smoking,” “drinking,” “sun exposure,” “speeding,” and so on. With disease, age is almost always a factor.</p>
<p>Imagine that the risk of D in the next 10 years is p_0 = 20% for a 20-year old who doesn’t smoke, drink, sunbathe, or drive too fast. For the sake of illustration, let’s imagine that smoking triples the risk, drinking doubles it, sunbathing increases it by 50%, speeding doubles it, and each year of age increases it by 2%. The 50-year old who has all the risk factors therefore faces a risk of D of</p>
<p>$<em>&nbsp;</em> &nbsp;&nbsp;<em> &nbsp;&nbsp;</em>&nbsp;&nbsp;<em> &nbsp;&nbsp;</em> = 6.52 $</p>
<p>This is ridiculous: you can’t have a probability of 6.52. In general, it doesn’t work to multiply the effects of risk factors.</p>
<p>Instead, the standard statistical/mathematical approach is to represent risk using <em>log odds</em>.</p>
<p>Base risk: 20% which corresponds to odds of 2/8 or log odds of -1.39.</p>
<p>Smoking: Triples the risk to 60%, that is odds of 6/4 or log odds of 0.405. This is an increase of <span class="math inline">\((0.405 - -1.39) = 1.75\)</span> above the base risk.</p>
<p>Drinking: Doubles the risk to 40%, that is odds of 4/6 or log odds of -0.405, an increase above the base rate of <span class="math inline">\(-0.405 - -1.39 = 0.985\)</span>.</p>
<p>To <strong>accumulate risk</strong>, rather than multiplying, we add in the log-odds increment due to each risk factor.</p>
<p>If multiplying, smoking and drinking for a 20-year old would produce a risk of <span class="math inline">\(0.2 \times 3 \times 2 = 1.2\)</span>, which cannot be a probability.</p>
<p>Adding the log-odds increments gives the log-odds for a 20-year smoker/drinker as <span class="math inline">\(-1.39 + 1.75 + 0.985 = 1.345\)</span>. The odds for this person are therefore <span class="math inline">\(e^{1.345} = 3.83\)</span>. Converting odds back to probability gives <span class="math inline">\(\frac{3.83}{1+3.83} = 79\%\)</span>.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The sigmoidal pattern
</div>
</div>
<div class="callout-body-container callout-body">
<p>Show the risk as a function of age in the multiplying style: <span class="math inline">\(0.2 \times 1.02^t\)</span>.</p>
<p>Now show risk as a function of age in log odds format. Base is <span class="math inline">\(-1.39\)</span>. One year’s increment gives <span class="math inline">\(0.2 \times 1.02 = 0.204\)</span> which converts to <span class="math inline">\(\ln(\frac{.204/.796}) = -1.36\)</span>, an increment of 0.03 in log-odds units.</p>
<p>In this format, risk as a function of age will be <span class="math inline">\(-1.39 + 0.03t\)</span>, where <span class="math inline">\(t\)</span> is the number of years past age 20. We can convert this to a probability as a function of age:</p>
<p><span class="math inline">\(p(t) = \frac{\exp(-1.39 + 0.03t)}{1 + \exp(-1.39 + 0.03t)}\)</span>. To emphasize the pattern, let’s follow the person’s risk over the next 200 years (even though nobody lives to age 220).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_plot</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">1.39+0.03</span><span class="sc">*</span>t)<span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">1.39+0.03</span><span class="sc">*</span>t)) <span class="sc">~</span> t, <span class="fu">bounds</span>(<span class="at">t=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NTI-Lesson33_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Human perception of risk
</div>
</div>
<div class="callout-body-container callout-body">
<p>People tend to perceive risk in a way that doesn’t correspond to a probability or a value scale (such as ice-cream sales). First, outcomes with a high probability are seen as certain. Outcomes with a very low probability are either seen as impossible or rounded up. So the perception of a one-in-a-million risk is seen as a risk on the order of 1% or 10%.</p>
<p>Second, there are “dread factors” that can dramatically increase the perceived risk. Examples are: “out of my control,” “impact on the unborn,” “hidden impact.” The dread-factor theory provides an explanation for why many people see commercial aviation as riskier than driving, or the huge aversion to low levels of radiation exposure.</p>
</div>
</div>
</section>
</section>
<section id="learning-checks" class="level2">
<h2 class="anchored" data-anchor-id="learning-checks">Learning Checks</h2>
<p>See <code>medGPA</code> from the Stat2Data package. Maybe come back to this in Lesson 34.</p>
<p>Maybe <code>Data2Stats::FlightResponse</code></p>
<p>Maybe space shuttle Challenger o-ring data.</p>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">33.1</h2>
<ol type="1">
<li>Convert probability to odds and log odds, and vice versa.</li>
</ol>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<hr>
</section>
<section id="xxx" class="level2">
<h2 class="anchored" data-anchor-id="xxx">33.XXX</h2>
<p>A major company in big trouble is planning to lay off 20% of its employees. You work in the personnel office and have constructed a multivariate model of the probability of an individual being laid off. The effect size of the different input factors in the model are as follows:</p>
<ul>
<li>age over 50 years: change in log-odds 1</li>
<li>software engineer: change in log-odds -0.5</li>
<li>pay level: change in log-odd rate 0.2 per $10,000 above the company average of $40K</li>
</ul>
<ol type="1">
<li><p>What are the odds of being laid off for an employee for whom you have no information about age, engineering capabilities, or pay level. -A- The risk of being laid off is 20% so the probability of not being laid off is 80%. The odds are therefore 20/80 = 0.25.</p></li>
<li><p>What are the log odds of an employee in (1) being laid off? -A- Simply the logarithm of the odds, so <span class="math inline">\(\log(0.25) = -1.4\)</span>.</p></li>
<li><p>Consider a 30-year old software engineer making $50,000 per year.</p>
<ul>
<li>What are the log odds of her being laid off? -A- At baseline, her log odds is -1.4. Being a software engineer, her log odds are lower by 0.5. But she makes more than the average pay by $10,000, which adds 0.2 to her log odds. Altogether, -1.4 - 0.5 + 0.2 = -1.7.</li>
<li>Translate the log odds into an absolute risk of her being laid off. -A- Undoing the logarithm on -1.7 gives an odds of 0.18, which corresponds to a probability of 0.18/(1 + 0.18) or 15%.</li>
</ul></li>
</ol>
<hr>
<p>In LC 24.2, we took as baseline inputs for [this online breast-cancer risk assessment model]((https://bcrisktool.cancer.gov/calculator.html), a 55-year-old, African-American woman who has never had a breast biopsy or any history of breast cancer, who doesn’t know her BRCA status, and whose close relatives have no history of breast cancer, whose first menstrual period was at age 13 and first child at age 23.</p>
<p>For this baseline case, the output of the model was a probability of 1.4% five-year risk of developing breast cancer. Finding out that one close relative has developed breast cancer elevates this risk to 2.2%.</p>
<p>These are absolute risks: probabilities. The effect size is 2.2 - 1.4 = 0.8 percentage points. When risks are specified as probabilities, differences in risks are in “percentage points.”</p>
<ol type="1">
<li><p>What <em>risk ratio</em> corresponds to the 1.4 to 2.2 change of risk? -A- This is a simple ratio: 2.2% / 1.4% which is 1.57.</p></li>
<li><p>Suppose (hypothetically) that the risks were ten times higher: 14% and 22%.</p>
<ol type="a">
<li>What would be the risk ratio? -A- Still 1.57.</li>
<li>What would be the percentage point change in absolute risk? -A- 8 percentage points.</li>
</ol></li>
<li><p>Put yourself in the place of the baseline woman who has just found out that a close relative developed breast cancer. Which way of reporting a change of risk is more pertinent to your personal life? -A- The change in absolute risk. Even though the risk ratios are the same in (1) and (2), the change in absolute risk is much greater in (2).</p></li>
</ol>
<hr>
</section>
<section id="documenting-software" class="level2">
<h2 class="anchored" data-anchor-id="documenting-software">Documenting software</h2>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Needless to say, a vendor doesn’t see sales as a “loss.” But “loss function” is a convenient term for the function relating value to <a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>