<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Danny Kaplan">
<meta name="dcterms.date" content="2022-10-13">

<title>Proposal for Math 300 Revisions - Math 300R Lesson r (lesson &lt;- 37) Reading Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Proposal for Math 300 Revisions</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule-of-objectives.html">Objectives</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../NTIs.html">NTIs</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Math 300R Lesson 37 Reading Notes</h1>
<p class="subtitle lead">False discovery</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Danny Kaplan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 13, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<blockquote class="blockquote">
<p><em>Ask, and it shall be given you; seek, and ye shall find; knock, and it shall be opened unto you: For every one that asketh receiveth; and he that seeketh findeth; and to him that knocketh it shall be opened.</em> – Matthew 7:7-8</p>
</blockquote>
<p>The modeling techniques we’ve covered are surprisingly powerful at identifying patterns in data. With power comes responsibility. This chapter is about how spurious patterns can arise in data and processes you can use to help ensure that the patterns your models identify are genuine.</p>
<p>It’s well known that people are particularly adept at finding patterns. To see this, spend a minute or two with <a href="#fig-random-scatter">Figure&nbsp;1</a>, which shows x-y pairs generated by a complex mathematical procedure called the Mersenne-Twister algorithm. How many of the structures created by Mersenne-Twister algorithm can you identify by eye? Take five of the stronger-looking patterns: clusters of points, large empty areas, strings of dots, etc. Write down a list of the patterns you spotted, including the coordinate location of each, a short description (e.g.&nbsp;“arc of dots”), and your subjective sense of how strong or convincing that pattern is.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-random-scatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Reading-notes-lesson-37_files/figure-html/fig-random-scatter-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 1: Training data (n = 1000)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>With your list in hand, look at <a href="#fig-random-scatter-2">Figure&nbsp;2</a> at the end of this section, which displays another n = 1000 x-y pairs generated by the same mathematical procedure. You’re going to check which of the patterns you found in the testing data are confirmed by the training data. Go through your list, looking at each location where you found a pattern in the training data and checking whether a similar pattern appears at that location in the testing data.</p>
<p>Were any of the patterns you saw in the training data confirmed by the testing data?</p>
<p>There’s no denying that the patterns you saw were in the data. But the Mersenne-Twister algorithm is specifically designed <em>not</em> to produce regular patterns. Any that you saw were accidental alignments in the particular sample of data from the algorithm.</p>
<p>The “patterns” abstractly referred to in the previous paragraphs appear in data. In data used for modeling, a pattern might be a relationship or correlation between two or more variables, or a cluster of rows in a data frame that have similar values for a response variable and explanatory variables.</p>
<p>Training models on data can encode the underlying patterns. For instance, a pattern in the data might result in a model generating detailed predictions or demonstrating a strong effect size of one variable on another.</p>
<p>A <em>valid</em> pattern is one that steadily appears from one sample of data to another (so long as the sample is big enough). Such consistency suggests that the pattern reflects some genuine aspect of the system generating the data. A <em>false</em> or <em>accidental</em> pattern is one that appears in a sample of data, but is unlikely to show up in another sample. This inconsistency indicates that conclusions based on this pattern are unlikely to be applicable in the future or in new situations.</p>
<p>The obvious, direct way to check the validity of a pattern encoded by a model is to see if the same pattern occurs in new data, data that was not used in building the initial model. <a href="Reading-notes-lesson-22.html">Lesson 22</a> took this approach by constructing a <em>sampling distribution</em> of a statistic such as an effect size. To create a sampling distribution, we train many models on different subsets of a data set.</p>
<p>When working with prediction models, the sign of a valid pattern is that the quality of the predictions – perhaps measured with a root-mean-square-error or a sensitivity/specificity – remains consistent when we calculate it on new data. A prediction that shows very small error on the data used to train the model but large error on new data is not a prediction that we can rely on in new settings.</p>
<p>The historical rapid growth in data analysis activity and the construction of data sets with large numbers of explanatory variables has made it easier to capture with models both valid patterns and false patterns. This makes it important to recognize that the false detection of patterns is possible whenever you train a model, to be aware of the characteristics of models and data that make false detection more likely, and to adopt procedures to mitigate the risk that the results of your work may not generalize beyond the particular sample of data you have in hand.</p>
<div class="cell" data-fig.margin="true">
<div class="cell-output-display">
<div id="fig-random-scatter-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Reading-notes-lesson-37_files/figure-html/fig-random-scatter-2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 2: Testing data (n = 1000).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="example-falsely-discovering-purchasing-habits" class="level2 example">
<h2 class="example anchored" data-anchor-id="example-falsely-discovering-purchasing-habits">Example: Falsely discovering purchasing habits</h2>
<p>You are a data scientist for an internet retailer, Potomac.com, which has just bought a national grocery chain, Austin Foods. You’re part of the team that is connecting the customer loyalty card data from Austin Foods with Potomac’s own large record of purchases. This is accomplished by offering a 10% discount for an item on Potomac to people who enter their Austin loyalty card number.</p>
<p>Potomac’s management wants to create a cross-marketing program in which a customer shopping at Potomac will be offered coupons for Austin products. The hope is that the coupon discount will attract new customers to start shopping at Austin’s. In order for this to work, it’s best if the coupons are for products that the customer finds attractive.</p>
<p>Your job is to build the <em>coupon assignment system</em>, that is, to figure out how to choose which products a customer is most likely to find attractive. To do this, you’ll create a set of classifiers that indicates the interest of a Potomac customer in an Austin product.</p>
<p>You’ve got data on 10,000 Potomac/Austin customers, that is, people whose records from Potomac and from Austin you can bring together. There are ten popular Austin products for which coupons can be offered. Among the 10,000 customers, about 16% have actually bought any given Austin product. You have built ten classifiers, one for each of the ten products. The input to the classifiers is 100 standard measures of a customer’s Potomac activity. The output of each classifier is the probability that the customer actually bought the corresponding Austin product.</p>
<p>The no-input classifier gives a probability of about 16% that the customer will buy the product. Management hopes that you will be able to segment the market to identify the products that a given person is much more likely to buy.</p>
<p>It’s a lot to ask of a person to sort through 100 potential explanatory variables to identify those that are predictive of buying a product. But it’s straightforward to use a model family that can <em>learn</em> on its own which variables are informative. You train the ten classifiers using a tree family of models.</p>
<blockquote class="blockquote">
<p>Heads up! The “data” has been created using random numbers, so that there are no actual relationships between the explanatory variables and the purchase outcomes. That is, no actual relationships aside from the accidental ones, such as the patterns encountered in <a href="#fig-random-scatter">Figure&nbsp;1</a>.</p>
</blockquote>
<p>To illustrate how the coupon assignment system works, Table @ref(tab:some-results) shows an intermediate step in the calculation, where a probability for each of the ten products is calculated for each customer.</p>
<div class="cell">

</div>
<div class="cell">

</div>
<p>Table @ref(tab:some-results) shows the output of the classifiers for just the first fifteen customers out of the 10,000 used to build the coupon selection system. For each person, all ten classifiers have been applied to estimate the probability that the person would buy each of the ten products. Highlighted in green are those products with a purchase probability greater than 40%.</p>
<p>The final output of the coupon assignment system is, for each customer, the identification of the specific products for which the probability is large. Reading Table @ref(tab:some-results), you’ll see that for person 1, product 9 merits a coupon. For person 2, products 2 and 10 merit a coupon. A winning product has not been identified for every customer, but you can’t please everyone.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'formattable'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:scales':

    comma, percent, scientific</code></pre>
</div>
<div class="cell-output-display">

<table class="table table-hover" style="margin-left: auto; margin-right: auto;">
<caption>(ref:some-results-cap)</caption>
 <thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1"></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="15"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Customer ID</div></th>
</tr>
  <tr>
   <th style="text-align:right;"> product </th>
   <th style="text-align:left;"> 1 </th>
   <th style="text-align:left;"> 2 </th>
   <th style="text-align:left;"> 3 </th>
   <th style="text-align:left;"> 4 </th>
   <th style="text-align:left;"> 5 </th>
   <th style="text-align:left;"> 6 </th>
   <th style="text-align:left;"> 7 </th>
   <th style="text-align:left;"> 8 </th>
   <th style="text-align:left;"> 9 </th>
   <th style="text-align:left;"> 10 </th>
   <th style="text-align:left;"> 11 </th>
   <th style="text-align:left;"> 12 </th>
   <th style="text-align:left;"> 13 </th>
   <th style="text-align:left;"> 14 </th>
   <th style="text-align:left;"> 15 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">44</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">71</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">73</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">0</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">89</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">100</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">0</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">22</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">3</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">3</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">0</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">64</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">25</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">69</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">20</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">73</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">20</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">4</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">4</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">21</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">62</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">80</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">0</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">17</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">25</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>(ref:some-results-cap) The output of the ten classifiers for the first 15 customers. Green highlighting is used for those products which a given customer is likely to buy.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `group_by_()` was deprecated in dplyr 0.7.0.
ℹ Please use `group_by()` instead.
ℹ See vignette('programming') for more help
ℹ The deprecated feature was likely used in the dplyr package.
  Please report the issue at &lt;]8;;https://github.com/tidyverse/dplyr/issueshttps://github.com/tidyverse/dplyr/issues]8;;&gt;.</code></pre>
</div>
</div>
<p>To test the performance of the system, we can look at the product/customer combinations for which a coupon was merited, and check how many of them actually corresponded to a purchase: it’s 74%. But for the combinations with no coupon, the purchase rate was only 11%.</p>
<p>The results are impressive. For about half of the customers, the coupon assignment system has identified customers/product combinations with a purchase probability of more than 40%. Often, the probability of purchase is considerably higher than 40%. Targeting each customer with a coupon for the right product is likely to generate a lot of new sales!</p>
<blockquote class="blockquote">
<p>Since data was generated using random numbers, we know that the “success” of the coupon assignment system is illusory. Later, we’ll see how the process was able to uncover so many accidental patterns from random data and list some things to look out for when modeling. But first, let’s provide a reliable method for you to identify when your results are based in accidental patterns: using testing data.</p>
</blockquote>
<p>A true measure of the performance of a model should be based not on the data on which the model was trained, but data which have been held back for use in testing and not used in training. For this example, we’ll use testing data consisting of 10,000 customers for whom we have the same 100 explanatory variables from the Potomac database and for whom we know if each customer purchased any of the ten products from Austin Foods. Only about 1 in 6 customers bought any single product from Austin. We want to see if the classifier assigns a high probability to those customers who did buy the product. If so, it means we can use just the 100 explanatory variables to find winning products for customers for whom we have no Austin purchasing data.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `as.tibble()` was deprecated in tibble 2.0.0.
ℹ Please use `as_tibble()` instead.
ℹ The signature and semantics have changed, see `?as_tibble`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.
ℹ The deprecated feature was likely used in the tibble package.
  Please report the issue at &lt;]8;;https://github.com/tidyverse/tibble/issueshttps://github.com/tidyverse/tibble/issues]8;;&gt;.</code></pre>
</div>
<div class="cell-output-display">

<table class="table table-hover" style="margin-left: auto; margin-right: auto;">
<caption>(ref:purchase-test-cap)</caption>
 <thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1"></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="15"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Customer ID</div></th>
</tr>
  <tr>
   <th style="text-align:right;"> product </th>
   <th style="text-align:left;"> 1 </th>
   <th style="text-align:left;"> 2 </th>
   <th style="text-align:left;"> 3 </th>
   <th style="text-align:left;"> 4 </th>
   <th style="text-align:left;"> 5 </th>
   <th style="text-align:left;"> 6 </th>
   <th style="text-align:left;"> 7 </th>
   <th style="text-align:left;"> 8 </th>
   <th style="text-align:left;"> 9 </th>
   <th style="text-align:left;"> 10 </th>
   <th style="text-align:left;"> 11 </th>
   <th style="text-align:left;"> 12 </th>
   <th style="text-align:left;"> 13 </th>
   <th style="text-align:left;"> 14 </th>
   <th style="text-align:left;"> 15 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">17</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">58</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">19</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">86</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">18</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">75</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">71</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">25</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">0</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">71</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">80</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">17</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">3</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">17</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">3</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">38</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">60</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">4</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">89</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">20</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">20</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">100</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">5</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">72</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">21</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">3</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">11</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">13</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">21</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold;    color: green !important;">71</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">16</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">14</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">6</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">15</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">10</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">17</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">19</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">7</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">12</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">9</span> </td>
   <td style="text-align:left;"> <span style="  font-style: italic;   color: gray !important;">8</span> </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>(ref:purchase-test-cap) Similar to Table @ref(tab:some-results) but for the <em>testing</em> data.</p>
<div class="cell">

</div>
<p>A valid evaluation of the performance of the system involves using the <em>testing</em> data rather than the <em>training</em> data. Figure @ref(fig:purchase-test) shows the assignment of coupons for the customers in the test data. Although coupons are assigned to these customers, the purchase rate for these items is only 16%, no different than the probability of purchase for no-coupon items. In other words, the coupon assignment system doesn’t work at all!</p>
</section>
<section id="sources-of-false-discovery" class="level2">
<h2 class="anchored" data-anchor-id="sources-of-false-discovery">Sources of false discovery</h2>
<p>How did the coupon classifier system identify so many accidental patterns, patterns that existed in the training data but not in the testing data?</p>
<p>One source of false discovery stems from having multiple potential response variables. In the Potomac/Austin example, there were ten different classifiers at work, one for each of the ten Austin products. Even if the probability of finding an accidental pattern in one classifier is small, looking in ten different places dramatically increases the odds of finding something.</p>
<p>Similarly, having a large number of explanatory variables – we had 100 in the coupon classifier – provides many opportunities for false discovery. The probability of an accidental pattern between one outcome and one explanatory variable is small, but with many explanatory variables each being considered it’s much more likely to find something.</p>
<p>A third source of false discovery at work in the coupon classifier relates to the family of models selected to implement the classifier. We used a tree model classifier capable of searching through the (many) explanatory variables to find ones that are associated with the response outcome. Unbridled, the tree model is capable of very fine stratification. Each coupon classifiers stratified the customers into about 200 levels. On average, then, there were about 50 customers in each strata. But there is variation, so many of the strata are much smaller, with ten or fewer customers. The small groups were constructed by the tree-building algorithm to have similar outcomes among the members, so it’s not surprising to see a very strong pattern in each group. For each classifier, about 15% of all customers fall into a strata with 20 or fewer customers.</p>
<p>To illustrate, <a href="#fig-tree-three">Figure&nbsp;3</a> shows the shape of the tree model for a typical coupon classifier. Each of the splits reflects an accidental alignment of the response variable with one of the explanatory variables. As more splits are made, the group of customers contained in the split becomes smaller. Many of the leaves on the tree contain just a handful of customers who accidentally had similar values for the several explanatory variables used in the splits.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tree-three" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="www/purchase-classifier-3.png" class="img-fluid figure-img" width="1402"></p>
<p></p><figcaption class="figure-caption">Figure 3: A sketch of one of the classifiers constructed for the coupon selection system. The tree-growing algorithm was allowed to keep going until the customer data was split up into very small strata.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The tree is too complex to be plausible as a real-world mechanism. None of the details in <a href="#fig-tree-three">Figure&nbsp;3</a> have any validity beyond the training data itself.</p>
</section>
<section id="identifying-false-discovery" class="level2">
<h2 class="anchored" data-anchor-id="identifying-false-discovery">Identifying false discovery</h2>
<p>We use data to build statistical models and systems such as the coupon-assignment machine. False discovery occurs when a pattern or model performance seen with one set of data does not generalize to other potential data sets.</p>
<p>The basic technique to avoid false discovery is called <strong>cross validation</strong>. One simple approach to cross validation splits the data frame into two randomly selected non-overlapping sets of rows: one for training and the other for testing. Use the training data to build the system. Use the <em>testing</em> data to evaluate the system’s performance.</p>
<p>Most often, cross validation is used to test model prediction performance such as the root-mean-square error or the sensitivity and specificity of a classifier. This can be accomplished by taking the trained model and providing as input the explanatory variables from the testing data, then comparing the model output to the actual response variable values in the testing data. Note that using testing data in this way does not involve retraining the model on the testing data.</p>
<p>How big should the training set be compared to the testing set? For now, we’ll keep things simple and encourage use of a 50:50 split or something very close to that.</p>
<p>This is a simple and reliable approach that should always be used.</p>
</section>
<section id="false-discovery-and-multiple-testing" class="level2">
<h2 class="anchored" data-anchor-id="false-discovery-and-multiple-testing">False discovery and multiple testing</h2>
<p>When the main interest is in an effect size, standard procedure calls for calculating a confidence interval on the effect. For example, a 2008 study examined the possible relationship between a woman’s diet before conception and the sex of the conceived child. The popular press was particularly taken by this result from the study:</p>
<blockquote class="blockquote">
<p>Women producing male infants consumed more breakfast cereal than those with female infants. The odds ratio for a male infant was 1.87 (95% CI 1.31, 2.65) for women who consumed at least one bowl of breakfast cereal daily compared with those who ate less than or equal to one bowlful per week. <span class="citation" data-cites="fetal-sex-2008">[@fetal-sex-2008]</span></p>
</blockquote>
<p>The model here is a classifier of the sex of the baby based on the amount of breakfast cereal eaten. The effect size tells the change in the odds of a male when the explanatory variable changes from one bowlful of cereal per week to one bowl per day (or more). This effect size is sensibly reported as a ratio of the two odds. A ratio bigger than one means that boys are more likely outcomes for the one-bowl-a-day potential mother than the one-bowl-a-week potential mother. The 95% confidence interval is given as 1.31 to 2.65. This confidence interval does not contain 1. In a conventional interpretation, this provides compelling evidence that the relationship between cereal consumption and sex is not a false pattern.</p>
<p>But the confidence interval is not the complete story. The authors are clear in stating their methodology: “Data of the 133 food items from our food frequency questionnaire were analysed, and we also performed additional analyses using broader food groups.” In other words, the authors had available more than 133 potential explanatory variables. For each of these explanatory variables, the study’s authors constructed a confidence interval on the odds ratio. Most of the confidence intervals included 1, providing no compelling evidence of a relationship between that food item and the sex of the conceived child. As it happens, breakfast cereal produced the confidence interval that was the most distant from an odds ratio of 1.</p>
<p>Let’s look at the range of confidence intervals that can be found from studying 100 potential random variables that are each unrelated to the response variable. We’ll simulate a response randomly generated “sex” G and B where the odds of G is 1. Similarly, each explanatory variable will be a randomly generated “consumption” high or low where the odds of high is 1. A simple stratification of sex by consumption will generate the odds of G for those cases with consumption Y and also the odds of G for those cases with consumption N. Taking the ratio of these odds gives, naturally enough, the odds ratio. We can also calculate from the stratified data a 95% confidence interval on the odds ratio.</p>
<p>So that the results will be somewhat comparable to the results in <span class="citation" data-cites="fetal-sex-2008">@fetal-sex-2008</span>, we’ll use a similar sample size, that is, n = 740. Table @ref(tab:sex-consumption-1) shows one trial of the simulation.</p>
<div class="cell">

</div>

<table>
<caption>
(ref:sex-consumption-1-cap)
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
high
</th>
<th style="text-align:right;">
low
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
182
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:right;">
211
</td>
<td style="text-align:right;">
182
</td>
</tr>
</tbody>

</table>
<p>(ref:sex-consumption-1-cap) A stratification of sex outcome (B or G) on consumption (high or low) for one trial of the simulation described in the text.</p>
<p>Referring to Table @ref(tab:sex-consumption-1), you can see that the odds of G when consumption is low is 182 / 182 = 1. The odds of G when consumption is high is 211/165 = 1.28. The 95% confidence interval on the odds ratio can be calculated. It is 0.95 to 1.73. Since that includes 1, the data underlying Table @ref(tab:sex-consumption-1) provide little or no evidence for a relationship between sex and consumption. This is exactly what we expect, since the simulation involves entirely random data.</p>
<p><a href="#fig-sex-consumption-simulation">Figure&nbsp;4</a> shows the 95% confidence interval on the odds ratio for 133 trials like that in Table @ref(tab:sex-consumption-1). The confidence interval from each trial is shown as a horizontal line. The large majority of them include 1. That’s to be expected because the data have been generated so that sex and consumption have no relationship except those arising by chance.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: geom_vline(): Ignoring `mapping` because `xintercept` was provided.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-sex-consumption-simulation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Reading-notes-lesson-37_files/figure-html/fig-sex-consumption-simulation-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 4: Confidence intervals on the odds ratio comparing female and male birth rates for many trials of simulated data with no genuine relationship between the explanatory and response variables.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Nonetheless, out of 133 simulations there are six where the confidence interval does not include 1. These are shown in red. By necessity, one of the intervals will be the most extreme. If instead of numbering the simulations, we had labelled them with food items – e.g.&nbsp;grapefruit, breakfast cereal, toast – we would have a situation very similar to what seems to have happened in the sex-vs-food study. (For a more detailed analysis of the impact of multiple testing in <span class="citation" data-cites="fetal-sex-2008">@fetal-sex-2008</span>, see <span class="citation" data-cites="young-2009">@young-2009</span>.)</p>
<p>Suppose now that half of the data used in <span class="citation" data-cites="fetal-sex-2008">@fetal-sex-2008</span> had been held back as testing data. Using the training data, it would be an entirely legitimate practice to generate hypotheses about which specific food items might be related to the sex of the baby. The validity of any one selected hypothesis could then be established using the testing data without the ambiguity introduced by multiple testing. The testing data confidence interval can be taken at face value; the training data confidence interval cannot.</p>
</section>
<section id="example-organic-discovery" class="level2 example">
<h2 class="example anchored" data-anchor-id="example-organic-discovery">Example: Organic discovery?</h2>
<p>It’s easy to find organic foods in many large grocery stores. Advocates of an organic diet are attracted by a view that it is sustainable, promotes small farms, and helps avoid contact with pesticides. There are also nay-sayers who make valid points, but that is not our purpose here. Informally, I find that many people and news reports point to the health benefits of an organic diet. Usually they believe that these benefits are an established fact.</p>
<p>A 2018 New York <em>Times</em> article observed:</p>
<blockquote class="blockquote">
<p><em>People who buy organic food are usually convinced it’s better for their health, and they’re willing to pay dearly for it. But until now, evidence of the benefits of eating organic has been lacking.</em> <span class="citation" data-cites="NYT-2018-10-23-Rabin">[@NYT-2018-10-23-Rabin]</span></p>
</blockquote>
<p>The new evidence of health benefits is reported in an article in the <em>Journal of the American Medical Association: Internal Medicine</em> <span class="citation" data-cites="baudry-2018">[@baudry-2018]</span></p>
<p>Describing the findings of the research, the <em>Times</em> article continued:</p>
<blockquote class="blockquote">
<p><em>Even after these adjustments [for covariates], the most frequent consumers of organic food had 76 percent fewer lymphomas, with 86 percent fewer non-Hodgkin’s lymphomas, and a 34 percent reduction in breast cancers that develop after menopause.</em></p>
</blockquote>
<p>The study warrants being taken seriously: it involved about 70,000 French adults among whom 1340 cancers were noted. The summary of organic foot consumption was a scale from 0 to 32 and included 16 labeled products including dairy, meat and fish, eggs, coffee and tea, wine, vegetable oils, and sweets such as chocolate. Adjustment was made for a substantial number of covariates: age, sex, educational level, marital status, income, physical activity, smoking, alcohol intake, family history of cancer, body mass index, hormonal treatment for menopause, and others.</p>
<p>Yet … the reseach displays many of the features that can lead to false discovery. For instance, results were reported for four different types of cancer: breast, prostate, skin, lymphomas. The study reports p-values and hazard ratios<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> comparing cancer rates among the four quartiles of the organic consumption index.</p>
<p>Comparing the most organic (average organic index 19.36/32) and the least organic (average index 0.72/32) groups the 95% confidence interval on the relative risk and p-values given in the study’s Table 4 are:</p>
<ul>
<li>Breast cancer: 0.66 - 1.16 (p = 0.38)</li>
<li>Prostate cancer: 0.61- 1.73 (p = 0.39)</li>
<li>Skin cancer: 0.49 - 1.28 (p = 0.11)</li>
<li>Lymphomas: 0.07 - 0.69 (p = 0.05)</li>
</ul>
<p>You might be surprised to see that the confidence interval on the relative risk for breast cancer includes 1.0, which suggests no evidence for an effect. As clearly stated in the report, the risk reduction for breast cancer is seen only in a subgroup of study participants: those who are postmenopausal. And even then, the confidence intervals continue to include 1.0:</p>
<ul>
<li>Breast cancer pre-menopausal: 0.67 - 1.52 (p = 0.85)</li>
<li>Breast cancer post-menopausal: 0.53 - 1.18 (p = 0.18)</li>
</ul>
<p>So where is the claimed 34% reduction in breast cancer cited in the New York Times article. It turns out the the study used two different indices of organic food consumption. The 0 to 32 scale which includes many items for which the amount consumed is very small (e.g., coffee, chocolate) and a “simplified, plant derived organic food score.” It’s only when you look at the full 0 to 32 scale that you see the reduction in post-menopausal breast cancer: the confidence interval is 0.45 to 0.96 (p = 0.03).</p>
<p>What about cancer rates overall? For the 0 to 32 scale the risk ratio was 0.58 - 1.01 (p = 0.10). To see the claimed reduction clearly you need to look at the simplified food score which gives 0.63 - 0.89 (p &lt; 0.005). And it’s only in comparing the highest-index quarter of participants with the lowerest quarter participants that any difference at all is seen in any type of cancer: the middle-half of participants show no difference in relative risk from the lowest-organic quarter of participants. (Because of this, had the study compared the highest quarter to the next highest quarter, they would have seen basically the same relative risks reported in the highest-to-lowest quarter comparison. Then the conclusion would have had a different flavor, perhaps to be reported as “Typical organic food consumption levels show no cancer benefits.”)</p>
<p>A further source of potential false discovery stems from the study’s starting and stop times. It’s not clear that these were pre-defined; the reported results are intermediate to a longer follow up. The choice to report intermediate results is another way that the number of opportunities for false discovery is increased. And the choice is important: for the follow-up time used, about 2% of the participants developed cancer. In an earlier study of more than 600,000 middle-aged UK women (average age 59), the incidence of cancer was four times larger: 8.6%. <span class="citation" data-cites="bradbury-2014">[@bradbury-2014]</span> That study did not find any relationship between organic food consumption and overall cancer rates, and found no relationship for 15 out of 16 different types of cancer. The exception is extremely interesting: non-Hodgkin lymphoma for which a similar result was found in the French study.</p>
<p>So is the study reported in the New York <em>Times</em> a matter of false discovery? It’s emotionally unsatisfying to discount a result about organic food and non-Hodgkin lymphoma simply because it’s part of a larger study that looked at many different combinations of cancer types and organic food indices. What if the researchers had only studied non-Hodgkin lymphoma – they would have gotten the same result and it wouldn’t have the deficiencies of being the strongest result of many possibilities. It would have stood on its own. But it doesn’t and we are left in a state of doubt.</p>
</section>
<section id="p_values" class="level2">
<h2 class="anchored" data-anchor-id="p_values">p-values and “significance”</h2>
<p>False discovery is not a new problem. The traditional logic can be traced back to 1710, when John Arbuthnot was examining London birth records from 1629 to 1710. Arbuthnot was surprised to find that for each year males were more common than females. In interpreting this finding, Arbuthnot refered to the conventional wisdom that births of males and females are equally likely. If this were the case, in any one year there might, by chance, be more females than males or the other way around. While it’s theoretically possible that chance might produce the string of 82 years with more males, it’s very unlikely. “From whence it follows, that it is Art, not Chance, that governs,” Arburthnot wrote. In more modern language, Arburthnot concluded that the hypothesis of equal rates of male and female births was not consistent with the data. Arbuthnot’s “Chance” corresponds to false discovery, while “Art” is a valid discovery.</p>
<p>Arburthnot’s logic became a standard component of statistical method.</p>
<ol type="1">
<li>Summarize the data into a single number called a “<strong>test statistic</strong>”. For Arburthnot the test statistic was the number of years where male births predominated, out of the 82 years being examined. The observed value of the test statistic was 82.</li>
<li>State a “<strong>null hypothesis</strong>”, typically something that is the conventional wisdom. For Arburthnot, the null hypothesis was that male and female births are equally likely.</li>
<li>Calculate a hypothetical quantity based on the null hypothesis: the probability that the test statistic produced in a world in which the null hypothesis holds true would be at least as large as the test statistic.</li>
<li>If the probability in (3) is small, one is entitled to “reject the null hypothesis.” Typically, “small” is defined as 0.05 or less.</li>
</ol>
<p>In the 1890s, statistical pioneer Karl Pearson invented a test statistic he called <span class="math inline">\(\chi^2\)</span> (“chi”-squared, with “chi” pronounced “ki” as in “kite”) that can be applied in a variety of settings. In 1900, Pearson published a table <span class="citation" data-cites="pearson-1900">[@pearson-1900]</span> that makes it an easy matter to look up the probability in step (3) above. He called this theoretical probability “P”, a name that has stuck but is conventionally written as lower-case “p”.</p>
<p>Data scientists tend to work with “big data”, but for many applications of statistics, data is so scarce that use of separate training and testing data is impractical. For such small data, the calculation of a p-value can be a sensible guard against false discovery. Still, a p-value does not address any of the sources of false discovery outlined in the previous sections of this chapter. When used with small data and simple modeling methods, those sources of false discovery are not so much of a problem. In small data there won’t be multiple explanatory variables that can be searched and there won’t be a choice of response variables. This doesn’t eliminate all problems, since in small data results can depend critically on the inclusion or exclusion of a single row of data. The name “<strong>p hacking</strong>” has been given to the various ways that researchers can manipulate p-values to get them below 0.05.</p>
<p>Another problem with p-values stems from misinterpretation of the admittedly difficult logic that underlies them. The misinterpretations are encouraged by the use of the term “<strong>tests of significance</strong>” to the p-value method. Particularly galling is the use of the description “<strong>statistically significant</strong>” to describe a result where p &lt; 0.05. The everyday meaning of “significant” as something of importance is in no way justified by p &lt; 0.05. Instead, the practical importance or not is more clearly signaled by examining an effect size. (It’s extremely disappointing that journalists, who are writing for an audience that for the most part has no understanding of p-value methodology, use “significant” when reporting on the statistics of research findings. It would be more honest to use a neutral term such as “null-validated” or “p-validated” which does not confuse the statistical result with actual practical importance.)</p>
<p>The p-value methodology has little or nothing to contribute to data science practice. When data is big there is a much more straightforward method to guard against false discovery: cross validation. And when data is big there is another, more fundamental problem with p-values. They are calculated with reference to a specific null hypothesis of “no effect” or “no relationship.” More realistically, they should be calculated with respect to a hypothesis of “trivial (but potentially non-zero) effect”. There are all sorts of mechanisms in the world (such as common causes) that can create the appearance of some effect or relationship. No matter how trivial in size this is, with sufficient data the p-value will become small. To illustrate, <a href="#fig-trivial-R">Figure&nbsp;5</a> shows the p-value as a function of the sample size n in a system with an R-squared of 0.001, which in most settings would be of no practical signficance.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: geom_hline(): Ignoring `mapping` because `yintercept` was provided.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-trivial-R" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Reading-notes-lesson-37_files/figure-html/fig-trivial-R-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 5: The p-value as a function of sample size n when the test statistic R-squared has the trivial value 0.001. The horizontal line shows the usual threshold for “significance” of p &lt; 0.05.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="notes-in-draft" class="level2">
<h2 class="anchored" data-anchor-id="notes-in-draft">NOTES IN DRAFT</h2>
<p>“Statistical crisis” in science</p>
<p>https://www.americanscientist.org/article/the-statistical-crisis-in-science</p>
<p>Garden of the Forking Paths</p>
<p>Ionedes</p>


</section>


<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Hazard ratios are analogous to risk ratios.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>