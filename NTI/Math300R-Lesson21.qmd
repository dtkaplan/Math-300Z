---
title: "Math 300R NTI Lesson `r (lesson <- 21)`"
subtitle: "DAGs, noise, and simulation"
author: "Prof. Danny Kaplan"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: yes
    css: NTI.css
  pdf_document:
    toc: yes
---


```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(ggformula) # Change plots to ggplot2
library(tibble)
knitr::opts_chunk$set(echo = TRUE)
```

## Objectives

#. Determine whether a proposed graph is directed and acyclic.

#. Having selected a response and one or more explanatory variables, identify other DAG notes as covariates. 

#. Generate data from simulations and use the data to model the relationships.


## Reading

TBD

[Reading note sketches](../Reading-notes/Reading-notes-lesson-21.qmd)



## Lesson

*Remember that you will be running this more like a lab than a lecture. You want them using `R` and answering questions. Have them open the notes rmd and work through it together.*


```{r message=FALSE, warning=FALSE}
library(dagsim)
library(mosaic)
```
:::

Introduce DAGs with multiple variables.

Generate data from them.

Use the data to summarize the relationships. 




::: {.callout-tip icon=false}
## Activity

1. What happens when you use the model `y ~ x + a`? Interpret those coefficients. Are they consistent with the DAG?

2. Are `x` and `a` related to one another? What does the DAG say about this? What does the model `a ~ x` say.
:::





::: {.callout-note}
## Inference example: Regression to the mean

Construct the Galton height DAG, simulate, and show that Galton's finding is replicated. 


:::

+ Work through the learning checks LCA.1 - LCA.2.

+ A DAG for "regression to the mean."
    - Ask what "regression" means in everyday English
    - Provide some history of the idea and point out that this is where the name "regression" comes from for the method of fitting a linear model linking a response variable to explanatory variable(s).
    - Show this DAG and ask what students think the consequences will be: what's the relationship between the parents' height and the (adult) child's height.
$$\epsilon \rightarrow parent \longleftarrow GENES \longrightarrow child \leftarrow \nu$$

::: {.callout-note}
## Simulation: Regression to the mean

```{r warning=FALSE}
rtm <- tibble(genes = 64 + rnorm(1000), 
              parent = genes + 0.5*rnorm(1000), 
              child  = genes + 0.5*rnorm(1000))
mod <- lm(child ~ parent, data = rtm) 
mod
# Convert this to ggplot2
gf_point(child ~ parent, data = rtm) %>%
  gf_lm(interval="confidence") %>%
  gf_abline(intercept = 0, slope = 1, color="red")
```

Interpret the coefficient and the graph.

a. What's the mean for the children and for the parents? [64 inches for each]
b. The red line runs along the diagonal. It reflects the statement that the children are, on average, the same as the parents.
c. The blue line is the regression model. The children are, on average, closer to the mean than the parents.

:::


## Learning Checks



## Documenting software

  * File creation date: `r Sys.Date()`
  * `r R.version.string`
  * `tidyverse` package version: `r packageVersion("tidyverse")`

