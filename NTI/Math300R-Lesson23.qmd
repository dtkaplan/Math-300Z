---
title: "Math 300R NTI Lesson `r (lesson <- 23)`"
subtitle: "sampling variation from a single sample"
author: "Prof. Danny Kaplan"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: yes
    css: NTI.css
  pdf_document:
    toc: yes
---


```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(ggformula) # Change plots to ggplot2
library(tibble)
knitr::opts_chunk$set(echo = TRUE)
```

## Objectives


#. Use bootstrapping to estimate sampling variation.

#. Infer sampling variation from a regression table: "standard error" of a model coefficient.

#. Construct and interpret confidence intervals on a model coefficient.

#. Understand and use scaling of confidence interval length as a function of $n$.

## Reading

TBD


## Lesson

::: {.callout-tip icon=FALSE}
## Setup 

```{r message=FALSE, warning=FALSE}
source("../_startup.R")
```
:::



The point of today's lesson is to show how some properties of the sampling distribution can be estimated from a single sample, rather than the many trials of sample-then-summarize that we used in Lesson 22.

## Bootstrapping

One approach is to mimic what we did when we had a DAG available: run many trials. But all we have is a sample, not the DAG. Can we run many trials from the sample itself?

Let's use the `moderndive::amazon_books` data set and the model tilde `list_price ~ num_pages`

Here's the results on the actual data:
```{r}
lm(list_price ~ num_pages, data = moderndive::amazon_books) %>% coefficients()
```
Interpretation: books cost about $12 plus 2 cents per page.

Here is our first stab at sampling from the data. Note that when sampling from a data set, `sample()` sets the sample size to be the same as the number of rows in the data set.
```{r}
trial <- function() {
  lm(list_price ~ num_pages, data = sample(moderndive::amazon_books)) %>% 
    coefficients()
}
{do(100) * trial()} %>% summarize(sd(Intercept), sd(num_pages))
```
::: {.callout-note icon=false}
## Questions

- How to interpret these numbers? What are they telling us about the sampling distribution on the regression coefficients?
- What's wrong?
- How to fix it?
:::

Introduce the `replace=TRUE` argument for `sample()`. Explain what it does and show the result. 
Is the result correct? We can't know, because we don't have access to the data-generating DAG in order to run many trials. But we can test the method on data generated from a DAG and confirm that it gives a reasonable result.

::: {.callout-important icon=false}
## Activity

Each student should construct one from a dag of his or her choice.
:::

### Regression table

In the readings, we mentioned that there are formulas for the standard deviation of the sampling distribution. [NEEDED TO GIVE THIS A NAME EARLIER: "SD of sampling variability", "standard error"] All you need to know about the formulas for the standard error is that i) they exist for linear regression and ii) the standard error is inversely proportional to $\sqrt{n}$.

Show how to construct the regression table and where to find the relevant standard error

```{r}
do(3) * {lm(list_price ~ num_pages, data = moderndive::amazon_books) %>% broom::tidy()}
```

```{r}
lm(list_price ~ num_pages, data = moderndive::amazon_books) %>% broom::glance()
```


## Margin of error

Confidence interval as estimate $\pm 2\times$ standard error.

Graphics for confidence interval. They need to know how to read them, not to make the graphics.

## Learning Challenges

:::: {.callout-note icon=false}
## LC 23.1 (Objective 2)

Vocabulary: Sampling distribution, standard error, sampling variability, sample size

::: {.callout-tip}
## Solution


The solution will go here.
:::
::::

## Documenting software

* File creation date: `r Sys.Date()`
* `r R.version.string`
* `tidyverse` package version: `r packageVersion("tidyverse")`
* `mosaic` package version: `r packageVersion("mosaic")`
* `dagsim` package version: `r packageVersion("dagsim")`

  

