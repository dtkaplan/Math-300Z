---
title: "Covariates"
author: "Prof. Danny Kaplan"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: yes
    css: NTI.css
  pdf_document:
    toc: yes
---

```{r include=FALSE}
lesson <- 28
source("../_startup.R")
library(splines)
```

Dr. Mary Meyer is a statistics professor at Colorado State University. In 2006, she published [an article](http://jse.amstat.org/v14n1/datasets.meyer.html) recounting an episode from family life:

> *When my daughter was in fourth grade, I took her shopping for dress shoes. I was disappointed in the quality of girls’ shoes at every store in the mall. The shoes for boys were sturdy and had plenty of room in the toes. On the other hand, shoes for girls were flimsy, narrow, and had pointed toes. In spite of the better construction for boys, the costs of the shoes were similar! For children the same age, boys had shoes they could run around in, while girls’ shoes were clearly for style and not comfort.*

> *Upon complaining about this state of affairs, I was told by sales representatives in two stores that boys actually had wider feet than girls, so needed wider shoes. Being very skeptical, I thought I would test this claim.*

We'll return to Dr. Meyer's project in a little bit. But now let's imagine how this situation might be addressed by someone who has not yet developed good statistical thinking skills. We'll call this imagined protagonist "Mr. Shoebuyer." Since the salesmen's claim was that girl's feet are narrower than boys, Mr. Shoebuyer heads out to measure the widths of girls' and boys' shoes.

A shoe store provides convenient place to measure the widths of lots of different shoe styles. Mr. Shoebuyer gets to the shoe store, heads to the children's section and starts measuring. For each shoe on display he records the shoe width and whether the shoe is for girls or boys. Here are his data: 

```{r echo=FALSE}
set.seed(102)
Shoebuyer_data <- KidsFeet %>% select(sex, width) %>% 
   group_by(sex) %>%
  sample_n(size=4) %>% 
  arrange(desc(sex))
knitr::kable(Shoe_sample)
```

Once back home, Mr. Shoebuyer uses his calculator to find the mean width of the shoes in each group. His results surprise him:

sex   | mean width
------|-----------
Girls | 9.0 cm
Boys  | 8.8 cm

Mr. Shoebuyer happens to be your uncle. He knows that you are taking a statistics course and writes you with a request to recheck his arithmetic. Putting on your statistical thinking hat, you see immediately that what's missing is a confidence interval on the effect size of sex on shoe width.

```{r}
Shoebuyer_data %>% lm(width ~ sex, data=.) %>% confint()
```

At the Thanksgiving break, you see your uncle. You say, "Sorry, Uncle, but you don't have nearly enough data to conclude that girls' feet are wider than boys'." Translating your confidence interval into plus-or-minus format, you point out that the difference between the sexes is $0.2 \pm 0.8$ cm. "You'll need enough data to get that 0.8 margin of error down to something like 0.2." You also point out that a shoe store might not be an appropriate place to collect data. "It's the feet, not the shoes, that you want to look at." 

Dr. Meyer worked worked with the third- and fourth-grade teachers at her daughter's school to collect data to illuminate the matter. Being a statistical thinker, before carrying out the data collection, she thought about what data would illuminate the matter. Her data, a sample of size $n=39$, are recorded in the `KidsFeet` data frame.

```{r}
lm(width ~ sex, data = KidsFeet) %>% confint()
```

Translated to plus-or-minus format, this confidence interval is $-0.4 \pm 0.3$. Whatever the format, Dr. Meyer's data provides some evidence that girls' feet are narrower than boys'.

As a statistical thinker, Dr. Meyer knows that even though the foot width is the original quantity of interest, other factors might be playing a role in the system. For example, boys' feet might trend longer or, perhaps, shorter than girls' feet. This should be taken into account. What we want is the effect size of `sex` on width, holding length constant. After all, when buying shoes you tell the salesperson your foot length (or "size") and they bring you shoes of that size to choose among.

```{r}
lm(width ~ sex + length, data=KidsFeet) %>% confint()
```

Although `sex` is the explanatory variable of primary interest to Dr. Meyer's question, she knows to include other explanatory variables that might be playing a role. Such explanatory variables, not of direct interest, are called "**covariates**." Dr. Meyer's expertise led her to think about possible covariates *before* collecting her data. That's why she went to the trouble of measuring foot length in addition to foot width.

The confidence interval on the `sexG` coefficient includes zero when `length` is taken into account. Dr. Meyer's little study provides evidence that, even if girls' shoes tend narrower than boys', the feet inside them have about the same shape for both sexes.


## "All other things being equal"

The common phrase "all other things being equal" is an important qualifier in describing relationships.  To illustrate: A simple claim in economics is that a high price for a commodity reduces the demand. For example increasing the price of heating fuel will reduce demand as people turn down thermostats in order to save money.  But the claim can be considered obvious only with the qualifier *all other things being equal*.  For instance, the fuel price might have increased because winter weather has increased the demand for heating compared to summer.  Thus, higher prices may be associated with higher demand. Unless you hold other variables constant – e.g., weather conditions – increased price may not in fact be associated with lower demand. 

In fields such as economics, the Latin equivalent of "all other things being equal" is sometimes used: "**ceteris paribus**". So, the economics claim would be, "higher prices are associated with lower demand, *ceteris paribus*." 

Although the phrase "all other things being equal" has a logical simplicity, it's impractical to implement "all."  Instead of the blanket "all other things," it's helpful to be able to consider just "some other things" to be held constant, being explicit about what those things are. Other phrases along these lines are "taking into account ..." and "controlling for ...."  Such phrases apply  when you want to examine the relationship between two variables, but there are additional variables that may be coming into play.  The additional variables are called "**covariates**" or "**confounders**".

::: {.callout-note}
## Example: Covariates and Death

This news report appeared in 2007:

> **Heart Surgery Drug Carries High Risk, Study Says.**
> A drug widely used to prevent excessive bleeding during heart surgery appears to raise the risk of dying in the five years afterward by nearly 50 percent, an international study found.
> The researchers said replacing the drug---aprotinin, sold by Bayer under the brand name Trasylol---with other, cheaper drugs for a year would prevent 10,000 deaths worldwide over the next five years.  
> Bayer said in a statement that the findings are unreliable because Trasylol tends to be used in more complex operations, and the researchers' statistical analysis did not fully account for the complexity of the surgery cases.
>The study followed 3,876 patients who had heart bypass surgery at 62 medical centers in 16 nations.  Researchers compared patients who received aprotinin to patients who got other drugs or no antibleeding drugs.  Over five years, 20.8 percent of the aprotinin patients died, versus 12.7 percent of the patients who received no antibleeding drug. [This is a 64% increase in the death rate.]
>When researchers adjusted for other factors, they found that patients who got Trasylol ran a 48 percent higher risk of dying in the five years afterward.
> The other drugs, both cheaper generics, did not raise the risk of death significantly. 
> The study was not a randomized trial, meaning that it did not randomly assign patients to get aprotinin or not.  In their analysis, the researchers took into account how sick patients were before surgery, but they acknowledged that some factors they did not account for may have contributed to the extra deaths. - Carla K. Johnson, Associated Press, 7 Feb. 2007

The report involves several variables.  Of primary interest is the relationship between (1) the risk of dying after surgery and (2) the drug used to prevent excessive bleeding during surgery.  Also potentially important are (3) the complexity of the surgical operation and (4) how sick the patients were before surgery.  Bayer disputes the published results of the relationship between (1) and (2) holding (4) constant, saying that it's also important to hold variable (3) constant.  

With aprotinin, the total relationship involves a death rate of 20.8 percent of patients who got aprotinin, versus 12.7 percent for others. This implies an increase in the death rate by a factor of 1.64.  When the researchers looked at a partial relationship (holding constant the patient sickness before the operation), the death rate was seen to increase by less: a factor of 1.48.    In evaluating the drug, it's best to examine its effects holding other factors constant.  So, even though the data directly show a 64% increase in the death rate, 48% is a more meaningful number since it adjusts for covariates such as patient sickness.  The difference between the two estimates reflect that sicker patients tended to be given aprotinin.  As the last paragraph of the story indicates, however, the researchers did not take into account all covariates. Consequently, it's hard to know whether the 48% number is a reliable guide for decision making. 
:::

## "*Mutatis mutandis*"

Using covariates in models enable the relationship between a response and an explanatory variable to be described "all other things being equal." Another phrase used in news stories is "after adjusting for ...", since the *all* in "all other things" is more properly restricted just to those factors represented by the covariates actually used in a model. So, Dr. Meyer's foot width results might be stated in everyday language as, "After adjusting for foot width, she found no difference in the widths of girls' and boys' feet."

Not to include covariates in a model amounts to "letting other things change as they will." In Latin this is "*mutatis mutandis*." In the foot-width example, the model `width ~ sex` looks at the differences in foot width for the two sexes. But sex is not the only thing "changed" when comparing foot width. Since `width ~ sex` ignores all other factors than sex, it is comparing boys and girls letting other things change as they will. In this case, comparing boys and girls involves not just the possible differences in foot width but the differences as well in other factors: foot length, body weight, etc.

::: {.callout-note}
## Example: One change can bring another

I was once involved in a budget committee that recommended employee health benefits for the college at which I work. At the time, college employees who belonged to the college's insurance plan received a generous subsidy for their health insurance costs. Employees who did not belong to the plan received no subsidy but were instead given a modest monthly cash payment.  After the stock-market crashed in year 2000, the college needed to cut budgets. As part of this, it was proposed to eliminate the cash payment to the employees who did not belong to the insurance plan. This proposal was supported by a claim that this would save money without reducing health benefits. I argued that this claim was based on an "all other things being equal" analysis: how expenditures would change assuming that the number of people belonging to the insurance plan remained constant. But in reality, the policy change would play out *mutatis matandis*; the loss of the cash payment would cause some employees, who currently received health benefits through their spouse's health plan, to switch to the college's health plan. That's what happened, contributing to an increase of health-care expenses. 
:::


