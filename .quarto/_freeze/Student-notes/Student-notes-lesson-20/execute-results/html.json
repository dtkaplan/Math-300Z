{
  "hash": "c1543e627ec53eba7f61ed989c62d36a",
  "result": {
    "markdown": "---\ntitle: \"Math 300 Lesson 20 Notes\"\nsubtitle: \"Simulation and sampling variation \"\nauthor: \"YOUR NAME HERE\"\ndate: \"December, 2022\"\noutput:\n  pdf_document:\n    toc: yes\n  html_document:\n    theme: lumen\n    toc: yes\n    toc_float: yes\n---\n\n\n\n\n## Overview\n\nThe word \"data\" comes from the Latin *datum*, meaning \"something given.\" Statistical thinkers remember that there is something behind the gift: the units of observation, the mechanism that creates the real relationships among the variables, and the process of sampling from the available units of observation those recorded in the data frame. The sampling process leaves traces---called **sampling variation***---in the models we construct from data. This Lesson gives you simulation tools to observe and quantify sampling variation. We will use these throughout the Lessons that follow.\n\n\n### Reading \n\n[Lesson **20** from *LST*](https://dtkaplan.github.io/Math-300R/Textbook/Reading-notes-lesson-20.html)\n\n\n\n### Objectives\n\n\n20.1 Construct sampling trials from a data frame or a simulation. \n\n20.2 Replicate sampling trials and calculate the amount of sampling variability.\n\n20.3 Recognize properties of directed, acyclic graphs (DAGs).\n\n\n[Updated list of objectives](../Objectives/Obj-lesson-20.html)\n\n### Libraries \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mosaic)\nlibrary(math300)\ndata(\"Whickham\", package=\"mosaicData\")\n```\n:::\n\n\n--------\n\n\nLesson \n--------\n\nIn the real world, creating a sample can be a laborious process, perhaps requiring field, experimental work, or building instrumentation. We're going to skip the hard stuff, and simply use the R function `sample()` which can create a sample from a data frame or a DAG (or other things such as the `1:10` in the example).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample(1:10, size = 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  9 10  6  2\n```\n:::\n:::\n\n\nNote: The `size=` argument specifies the size of the sample to be collected. In the text, we follow statistical convention and always refer to the sample size with the letter $n$, as in \"collect a sample of size $n=6$. But `sample()` does *not* use $n$ as the name of the size-setting argument.\n\n### Exercise 1\n\n#### Task 1.1\n\nWrite the R command to take a sample of size $n = 5$ from the `Whickham` data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# for Task 1.1\n```\n:::\n\n\nAnswer these questions:\n\n- Does `sample()` select from the rows or the columns of a data frame?\n- Will the same `sample()` command, when repeated, return the same sample?\n\n\n#### Task 1.2\n\nCompare the ages of the smokers and non-smokers in `Whickham` with this model:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# lm(age ~ smoker, data=Whickham) %>% coef()\n```\n:::\n\n\nNote the `smokerYes` coefficient is about -4.0. Interpret the `smokerYes` coefficient in everyday language to explain what it says about the ages of smokers and non-smokers. \n\n*Your answer*: \n\n#### Task 1.3\n\nMake an appropriate RESPEX-format graph of `Whickham` suited to the model `age ~ smoker`. Add a violin layer to the data layer. (Make sure to set the transparency `alpha` and the `fill` and `color` for an intelligible display.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For task 1.3\n```\n:::\n\n\nFrom the graph, explain in everyday language why the violin is so narrow for smokers aged 65 and above.\n\n*Your answer*:\n\nWhy is there a waist in the violin for non-smokers at age 50, while the violin for smokers has a corresponding bulge? Explain in everyday language.\n\n*Your answer*:\n\n### Exercise 2\n\n#### Task 2.1\n\nWrite an R statement that will find the sample size $n$ of `Whickham`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find sample size of `Whickham`.\n```\n:::\n\n\nIn the chunk below, copy the code from Task 1.1 to display the coefficients from the model `age ~ smoker`. But modify the code so that instead of using all of `Whickham` as training data, a sample size of $n=50$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Copy your code from Task 1.1, but set the sample size to n=50.\n```\n:::\n\n\nRun the above chunk several times, each time noting the coefficient `smokerYes`. The coefficient will differ from run to run: that's sampling variation. Which of these statements best describes the pattern? (Mark your answer **in bold**.)\n\na. The coefficients are always less than -4.0.\nb. The coefficients are always greater than -4.0\nc. The coefficients are scattered on both sides of -4.0.\n\n\n\n\n#### Task 2.2\n\nCopy your graphics code from Task 1.2, but modify it to set the sample size to $n=50$. \n\n::: {.cell}\n\n```{.r .cell-code}\n# Copy the graphics code from Task 1.2, modified for a sample of size n=50.\nggplot(sample(Whickham, size=50), aes(x=smoker, y=age)) +\n  geom_jitter(alpha=0.5, width=0.2) + \n  geom_violin(alpha=0.2, fill=\"blue\", color=NA)\n```\n\n::: {.cell-output-display}\n![](Student-notes-lesson-20_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nRepeat the command many times, each time checking the violin for signs of the non-smoker waist and smoker bulge at around age 50. \n\na. Does the waist-bulge pattern appear reliably for a sample of size $n=50$?  \nb. Find a sample size at which the waist-bulge pattern occurs at least 3/4 of the time?\n    \n*Your answer here:*\n\n### Exercise 3\n\nIn this exercise, you will practice with the `do()` function that lets you run multiple replications of a trial. \n\n#### Task 3.1\n\nIn this task, the trial will be very simple: Fit the `age ~ smoker` model to `Whickham` and display the coefficients. The code to run a trial is inside the curly braces `{ }`. The `do()` function goes before the curly braces. There is always a `*` sign between `do()` and the curly braces.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Trials <- do(5) * { lm(age ~ smoker, data=Whickham) %>% coef() }\n# Trials\n```\n:::\n\n\nThe collection of `Trials` is a data frame that includes the results from each trial, stacked one above the next.\n\nYou may be surprised to see that the columns of `Trials` repeat the same number over and over again. Explain what it is about the command inside the `{ }` that causes the result to be the same every time the trial is run. (See the next task if you can't figure it out.)\n\n*Your answer here*:\n\n#### Task 3.2\n\nThe typical use for `do()` is to repeat trials, each of which involves some random component, such as drawing a sample.\n\nModify the code from Task 3.1 so that the training data is a sample of size $n=50$ from `Whickham`. Also, modify the argument to `do()` so that there will be 10 rows in `Trials`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# modify this code\n# Trials <- do(5) * { lm(age ~ smoker, data=Whickham) %>% coef() }\n# Trials\n```\n:::\n\n\nConfirm that the coefficients vary from trial to trial, that is, from one sample to another.\n\nTry several different sample sizes (that is, $n=100, 200, 300$). Does the amount of trial-to-trial variation in the coefficients get bigger or smaller as the sample size increases?\n\n*Your answer here*:\n\n\n### Exercise 4\n\nYou can use `sample()` to take samples from a DAG. For instance, consider\n`dag02`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_draw(dag02)\n```\n\n::: {.cell-output-display}\n![](Student-notes-lesson-20_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nprint(dag02)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nx ~ exo()\na ~ exo()\ny ~ 3 * x - 1.5 * a + 5 + exo()\n```\n:::\n\n```{.r .cell-code}\nsample(dag02, size=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n       x       a     y\n   <dbl>   <dbl> <dbl>\n1 -1.29  -0.0864 0.380\n2  1.35   0.342  9.39 \n3  1.39  -0.450  9.83 \n4 -0.983  0.402  2.42 \n5  0.803 -0.685  8.46 \n```\n:::\n:::\n\n\n#### Task 4.1\n\nHere is the code for a single trial in which a sample of size $n=5$ is collected from `dag02` and used to train the model `y ~ a + x`, which corresponds exactly to the formula for `y` in the DAG.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# lm(y ~ a + x, data=sample(dag02, size=5)) %>% coef()\n```\n:::\n\n\nNotice that the coefficients roughly match those in the `dag02` formula for `y`.\n\n#### Task 4.2\n\nCopy from Task 4.1 the code to run one trial. (Make sure to take out the comment symbol!)\n\nThen modify the copied code to place the one-trial code in curly braces, and use `do(10)*` to run ten trials.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For Task 4.2\n```\n:::\n\n\nBy trial and error, find a sample size $n$ that's large enough so that the coefficients from the trials reliably match those in the `y` formula from `dag02`, varying by at most by $\\pm 0.1$. How big a sample is required for this?\n\n*Your answer here*:\n\nRepeat the previous, but find a sample size large enough so that the coefficients differ from those in the `y` formula by at most $\\pm 0.01$. How big a sample is required for this?\n\n*Your answer here*:\n\n\n### Going further \n\nYou can create your own DAGs. Use `dag_make()`, which takes tilde expressions as arguments. The left-hand side of each tilde expression is the name of a node. The right-hand side is an arithmetical formula to create a value from that node from the values of previous nodes or exogenous random number generators like `exo()`. (See the help page `?dag_make` for more information.) For example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_own_dag <- dag_make(\n  node_1 ~ exo(0.01) + 3,\n  second ~ 2*node_1 + exo(0.1) - 5,\n  node_C ~ 10*(node_1 + second) + exo() \n)\ndag_draw(my_own_dag)\n```\n\n::: {.cell-output-display}\n![](Student-notes-lesson-20_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\nprint(my_own_dag)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnode_1 ~ exo(0.01) + 3\nsecond ~ 2 * node_1 + exo(0.1) - 5\nnode_C ~ 10 * (node_1 + second) + exo()\n```\n:::\n\n```{.r .cell-code}\nsample(my_own_dag, size=10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 3\n   node_1 second node_C\n    <dbl>  <dbl>  <dbl>\n 1   3.00  0.929   39.2\n 2   3.02  1.28    42.9\n 3   2.99  0.918   38.7\n 4   3.02  0.883   38.3\n 5   3.01  0.905   37.5\n 6   3.00  1.04    39.2\n 7   3.01  0.956   39.7\n 8   3.01  0.951   39.8\n 9   2.99  1.03    42.0\n10   3.00  1.07    40.4\n```\n:::\n:::\n\n\nNotice that by using a node on the right-hand side of a tilde expression only when it has already been created by a previous tilde expression, you guarantee that the graph will be acyclic.\n\n#### Optional task\n\nCreate a DAG that has the same arrangement of causal connections as \"[Professor Butts and the Self-Operating Napkin](https://en.wikipedia.org/wiki/Rube_Goldberg_machine),\" illustrated below:\n\n![](Professor-Butts.png)\n\nProfessor Butts and the Self-Operating Napkin (1931). `Soup_spoon` (A) is raised to mouth, pulling `string` (B) and thereby jerking `ladle` (C), which throws `cracker` (D) past `toucan` (E). Toucan jumps after cracker and `perch` (F) tilts, upsetting `seeds` (G) into `pail` (H). Extra weight in pail pulls `cord` (I), which opens and ignites `lighter` (J), setting off `skyrocket` (K), which causes `sickle` (L) to cut `string_m` (M), allowing pendulum with attached napkin to swing back and forth, thereby `wiping_chin`.\n\n\n***\n\n## Documenting software \n\n  * File creation date: 2022-12-27\n  * R version 4.2.1 (2022-06-23)\n\n\n",
    "supporting": [
      "Student-notes-lesson-20_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}