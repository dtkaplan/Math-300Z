{
  "hash": "0ef592780c8c89609513c85656873705",
  "result": {
    "markdown": "---\ntitle: \"Math 300R NTI Lesson 33\"\nsubtitle: \"Measuring and accumulating risk\"\nauthor: \"Prof. Danny Kaplan\"\ndate: \"November 04, 2022\"\noutput:\n  html_document:\n    theme: lumen\n    toc: yes\n    toc_float: yes\n    css: NTI.css\n  pdf_document:\n    toc: yes\n---\n\n\n\n\n\n## Objectives\n\n\n\n\n\n\n\n\n33.1. Distinguish between absolute and relative risk and identify when a change in risk is being presented as absolute or relative.\n\n33.2. Calculate and correctly interpret other presentations of differences in risk: population attributable fraction, NTT, odds ratio.\n\n33.3. Interpret effect size as stated in log odds.\n\n\n\n## Reading\n\nTBD\n\n\n## Lesson\n\n### Risk\n\nIntroduce words related to \"risk\" and try to convert them into seeing a continuum of \"risk\" to \"opportunity,\" that is, uncertain outcomes that could be positive or negative. (\"Risk reduction,\" \"volatility,\" \"gain,\" \"gambling\").\n\nEach risky outcome is quantified by two numbers: a probability, and a value. It's easiest to talk about the value measured in dollars, but there of course other scales: \"lives (lost or saved),\" \"years of life,\" \"happiness,\" \"satisfaction,\" etc. Unfortunately, we don't have standard numerical scales for these.\n\n(Epidemiologists have a scale for quantifying health outcome: Quality adjusted life years (QALYs) which would take a class session on its own to explain, but which is highly instructive.) \n\nA \"loss function\" takes as input a possible outcome of an uncertain event and produces as output a value, which we might measure in dollars or QALYs or lives, etc. For the sake of definiteness, denote a loss function as $L(\\cal O)$, where $\\cal O$ is an outcome of the uncertain event. In quantifying loss, each possible outcome $\\cal O$ is associated with a probability. Let's call this $p(\\cal O)$. Mathematical philosophers have been arguing since the mid 1600s about what exactly is meant by probability. Don't expect a resolution to this quandry. For our purposes, it suffices to think about a probability of an outcome in the context of a prediction model, using the tools from [Lesson 26](Math300R-Lesson26.html). \n\n::: {.callout-note icon=false}\n## Example: Ice cream sales\n\nTo illustrate, imagine the situation of an ice-cream pushcart vendor. If it is cold or rainy, sales will be slight. If it's beautiful and hot, sales will be high. Help the students construct a plausible \"loss\" function: sales versus temperature.^[Needless to say, a vendor doesn't see sales as a \"loss.\" But \"loss function\" is a convenient term for the function relating value to  ] Then generalize that into a function with two inputs, say, raininess and temperature. Or even three inputs: day of the week/holiday, raininess and temperature. Whatever the inputs, the output is sales of ice cream.\n:::\n\n### Simplifying loss\n\nWe have two functions that, together, quantify risk. A loss function $L(\\cal O$ and a probability function $p(\\cal O)$ where $\\cal O$ is the uncertain outcome of the event. It's very common to compose these two functions into a single function: $p(L(\\cal O))$. Imagine $L(\\cal O)$ has an output denominated in, say, dollars. The composed function then looks like $p(\\$)$. There may be many different outcomes that lead to the same $ loss, but lumping them together as a single $ outcome gives a function $p(\\$)$. Presented this way, risk measurement is reduced to a single function with a single input, $, and an output in the form of a probability.\n\n### Probability, odds, log odds\n\nThe scale generally used for uncertainty is \"probability,\" a number between 0 and 1. But there are other scales in use and sometimes these have advantages for doing calculations. The two most important are:\n\ni. Odds\nii. Log odds\n\nAny probability can be converted to an odds and vice versa. Similarly, log odds can be converted into odds by using exponentiation (or vice versa, by using the logarithm function). \n\n::: {.callout-note icon=false}\n## Odds and gambling\n\nThe bookie arranges things so that the money staked by the gamblers is simply redistributed. The winners get back their stake plus the money staked by the losers. The odds given reflect the balance between the winners' stakes and the losers' stakes. If $50 is bet on A and $25 on B, then the odds on A will be 1:2. That is, the winners, if A is the outcome, will get $25 plus their stake back. Since their stake was $50, the odds will be 1:2. On the other hand, if B is the outcome, the winners will get $50 plus their stake. This corresponds to odds of 2:1.\n:::\n\n### Accumulating loss\n\nProvide a situation where there are many \"risk factors\" for an outcome. Suppose the outcome is disease D and there are risk factors $R_1$, $R_2$, $R_3$, ..., say \"smoking,\" \"drinking,\" \"sun exposure,\" \"speeding,\" and so on. With disease, age is almost always a factor.\n\nImagine that the risk of D in the next 10 years is p_0 = 20% for a 20-year old who doesn't smoke, drink, sunbathe, or drive too fast. For the sake of illustration, let's imagine that smoking triples the risk, drinking doubles it, sunbathing increases it by 50%, speeding doubles it, and each year of age increases it by 2%. The 50-year old who has all the risk factors therefore faces a risk of D of\n\n$\\underbrace{0.2}_\\text{base rate}\\ \\times \\underbrace{3}_\\text{smoking} \\ \\times \\ \\underbrace{2}_\\text{drinking} \\ \\times \\ \\underbrace{1.5}_\\text{sunbathing}\\ \\times \\ \\underbrace{2}_\\text{speeding} \\ \\times \\ \\underbrace{1.02^{30}}_\\text{30 more years of age} = 6.52 $\n\nThis is ridiculous: you can't have a probability of 6.52. In general, it doesn't work to multiply the effects of risk factors.\n\nInstead, the standard statistical/mathematical approach is to represent risk using *log odds*. \n\nBase risk: 20% which corresponds to odds of 2/8 or log odds of -1.39. \n\nSmoking: Triples the risk to 60%, that is odds of 6/4 or log odds of 0.405. This is an increase of $(0.405 - -1.39) = 1.75$ above the base risk.\n\nDrinking: Doubles the risk to 40%, that is odds of 4/6 or log odds of -0.405, an increase above the base rate of $-0.405 - -1.39 = 0.985$.\n\nTo **accumulate risk**, rather than multiplying, we add in the log-odds increment due to each risk factor.\n\nIf multiplying, smoking and drinking for a 20-year old would produce a risk of $0.2 \\times 3 \\times 2 = 1.2$, which cannot be a probability.\n\nAdding the log-odds increments gives the log-odds for a 20-year smoker/drinker as $-1.39 + 1.75 + 0.985 = 1.345$. The odds for this person are therefore $e^{1.345} = 3.83$. Converting odds back to probability gives $\\frac{3.83}{1+3.83} = 79\\%$.\n\n::: {.callout-note icon=false}\n## The sigmoidal pattern\n\nShow the risk as a function of age in the multiplying style: $0.2 \\times 1.02^t$. \n\nNow show risk as a function of age in log odds format. Base is $-1.39$. One year's increment gives $0.2 \\times 1.02 = 0.204$ which converts to $\\ln(\\frac{.204/.796}) = -1.36$, an increment of 0.03 in log-odds units. \n\nIn this format, risk as a function of age will be $-1.39 + 0.03t$, where $t$ is the number of years past age 20. We can convert this to a probability as a function of age:\n\n$p(t) = \\frac{\\exp(-1.39 + 0.03t)}{1 + \\exp(-1.39 + 0.03t)}$. To emphasize the pattern, let's follow the person's risk over the next 200 years (even though nobody lives to age 220).  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nslice_plot(exp(-1.39+0.03*t)/ (1+exp(-1.39+0.03*t)) ~ t, bounds(t=0:200))\n```\n\n::: {.cell-output-display}\n![](NTI-Lesson33_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n:::\n\n\n\n\n::: {.callout-note icon=false}\n## Example: Human perception of risk\n\nPeople tend to perceive risk in a way that doesn't correspond to a probability or a value scale (such as ice-cream sales). First, outcomes with a high probability are seen as certain. Outcomes with a very low probability are either seen as impossible or rounded up. So the perception of a one-in-a-million risk is seen as a risk on the order of 1% or 10%.\n\nSecond, there are \"dread factors\" that can dramatically increase the perceived risk. Examples are: \"out of my control,\" \"impact on the unborn,\" \"hidden impact.\" The dread-factor theory provides an explanation for why many people see commercial aviation as riskier than driving, or the huge aversion to low levels of radiation exposure.\n:::\n\n## Learning Checks\n\n\n\n\n\n\n\n\n\nSee `medGPA` from the Stat2Data package. Maybe come back to this in Lesson 34.\n\n\nMaybe `Data2Stats::FlightResponse`\n\nMaybe space shuttle Challenger o-ring data.\n\n## 33.1\n\n1. Convert probability to odds and log odds, and vice versa.\n\n\n::: {.callout-note}\n## Solution\n\n:::\n\n--------\n\n## 33.XXX\n\nA major company in big trouble is planning to lay off 20% of its employees. You work in the personnel office and have constructed a multivariate model of the probability of an individual being laid off. The effect size of the different input factors in the model are as follows:\n\n- age over 50 years: change in log-odds 1\n- software engineer: change in log-odds -0.5\n- pay level: change in log-odd rate 0.2 per $10,000 above the company average of $40K\n\n1. What are the odds of being laid off for an employee for whom you have no information about age, engineering capabilities, or pay level. -A- The risk of being laid off is 20% so the probability of not being laid off is 80%. The odds are therefore 20/80 = 0.25.\n\n2. What are the log odds of an employee in (1) being laid off? -A- Simply the logarithm of the odds, so $\\log(0.25) = -1.4$. \n\n3. Consider a 30-year old software engineer making $50,000 per year. \n    - What are the log odds of her being laid off? -A- At baseline, her log odds is -1.4. Being a software engineer, her log odds are lower by 0.5. But she makes more than the average pay by $10,000, which adds 0.2  to her log odds. Altogether, -1.4 - 0.5 + 0.2  = -1.7.\n    - Translate the log odds into an absolute risk of her being laid off. -A- Undoing the logarithm on -1.7 gives an odds of 0.18, which corresponds to a probability of 0.18/(1 + 0.18) or 15%. \n\n--------\n\nIn LC 24.2, we took as baseline inputs for [this online breast-cancer risk assessment model]((https://bcrisktool.cancer.gov/calculator.html),  a 55-year-old, African-American woman who has never had a breast biopsy or any history of breast cancer, who doesn't know her BRCA status, and whose close relatives have no history of breast cancer, whose first menstrual period was at age 13 and first child at age 23.  \n\nFor this baseline case, the output of the model was a probability of 1.4% five-year risk of developing breast cancer. Finding out that one close relative has developed breast cancer elevates this risk to 2.2%. \n\nThese are absolute risks: probabilities. The effect size is 2.2 - 1.4 = 0.8 percentage points. When risks are specified as probabilities, differences in risks are in \"percentage points.\"\n\n1. What *risk ratio* corresponds to the 1.4 to 2.2 change of risk? -A- This  is a simple ratio: 2.2% / 1.4% which is 1.57.\n\n2. Suppose (hypothetically) that the risks were ten times higher: 14% and 22%. \n    a. What would be the risk ratio? -A- Still 1.57.\n    b. What would be the percentage point change in absolute risk? -A- 8 percentage points.\n\n3. Put yourself in the place of the baseline woman who has just found out that a close relative developed breast cancer. Which way of reporting a change of risk is more pertinent to your personal life? -A- The change in absolute risk. Even though the risk ratios are the same in (1) and (2), the change in absolute  risk is much greater in (2).\n\n--------\n\n\n\n\n\n## Documenting software\n\n  \n\n",
    "supporting": [
      "NTI-Lesson33_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}