{
  "hash": "14fe36925a64ee6d410c236c38d704ab",
  "result": {
    "markdown": "---\ntitle: \"Math 300R NTI Lesson 32\"\nsubtitle: \"Experiment and random assignment\"\nauthor: \"Prof. Danny Kaplan\"\ndate: \"December 27, 2022\"\noutput:\n  html_document:\n    theme: lumen\n    toc: yes\n    toc_float: yes\n    css: NTI.css\n  pdf_document:\n    toc: yes\n---\n\n\n\n\n\n## Objectives\n\n\n\n\n\n\n\n\n32.1 Properly use nomenclature of experiment.\n\n32.2 Correctly re-draw DAG for an ideal experimental intervention.\n\n32.3 Use blocking to set assignment to treatment or control.\n\n\n## SAVE these for NTIs?\n\n\n\n\n::: {.cell .column-margin}\n\n```{.r .cell-code}\nbednet_dag <- dag_make(\n  region ~ exo(),\n  enthusiasm ~ exo(),\n  nutrition ~ exo(), \n  treatment ~ region + enthusiasm + nutrition,\n  polio ~ treatment + region + enthusiasm + nutrition\n)\ndag_draw(bednet_dag, seed=110, vertex.label.cex=1, vertex.size=30)\n```\n\n::: {.cell-output-display}\n![The bed net experiment without random assignment](NTI-Lesson32_files/figure-html/bednet_dag1-1.png){width=672}\n:::\n:::\n\n::: {.cell .column-margin}\n\n```{.r .cell-code}\nbednet_dag2 <- dag_make( \n  region ~ exo(),\n  enthusiasm ~ exo(),\n  nutrition ~ exo(),\n  random_assignment ~ exo(),\n  treatment ~ random_assignment,\n  polio ~ treatment + region + enthusiasm + nutrition)\ndag_draw(bednet_dag2, seed=111, vertex.label.cex=1, vertex.size=30)\n```\n\n::: {.cell-output-display}\n![The bed net experiment with random assignment.](NTI-Lesson32_files/figure-html/bednet_dag2-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n## Reading\n\nTBD\n\n\n## Lesson\n\n\nShort discussion about the words \"hypothesis\" and \"theory.\" Try to establish a simple, concrete definition of hypothesis: \"A statement about the world that might or might not be correct.\"\n\n::: {.callout-note icon=FALSE}\n## Defining \"hypothesis\"\n\ni. A supposition or proposed explanation made on the basis of limited evidence as a starting point for further investigation: professional astronomers attacked him for popularizing an unconfirmed hypothesis.\nii. Philosophy a proposition made as a basis for reasoning, without any assumption of its truth: [with clause] : the hypothesis that every event has a cause.\n\nORIGIN: late 16th century: via late Latin from Greek hupothesis ‘foundation’, from hupo ‘under’ + thesis ‘placing’.\n\nSource: *New Oxford American Dictionary*\n:::\n\nA DAG is merely a hypothesis about how mechanisms function. One of the prime objectives of \"science,\" be it a natural science like chemistry or a social science like economics, is to provide evidence for an against relevant hypotheses. \n\nIt's a common view of science, at least in sciences such as chemistry or physics or molecular genetics, that the theories (say, $F = ma$ or the translation of DNA triples into amino acids) are a complete and truthful description of the world. The word \"theory\" itself aids in this perception and often one studies \"theory\" in order to be able to calculate the outcomes in various situations, for instance the speed over time of a rocket accelerating upward as it burns fuel.  We don't talk about the \"hypothesis of relativity\" or \"quantum hypothesis.\" The word \"hypothesis\" suggests doubt. There was certainly substantial doubt in the early days of relativity or quantum mechanics or even Newton's theory of universal gravitation. But evidence has been adduced to such an extent that the doubt is practically dispelled and what were once hypotheses are now considered theories. (There's also a pattern of using \"theory\" to promote hypotheses into being regarded as more substantial. An example is \"string theory,\" which is not a generally accepted way of describing nature. The \"theory of dark matter\" is similar.)\n\n### Evidence for or against hypotheses\n\n1. **Prediction and observation**. \n\nParticularly noteworthy are predictions that go against other hypotheses. For example, Newtonian gravitation isn't a wave phenomenon, but general relativity (Einstein's theory of gravity) does predict wave-like behavior. In (Lesson 26)[Math300R-Lesson26.html] we discussed techniques for making predictions that incorporate uncertainty. This provides a means to refine judgements about the extent to which a prediction is supported by observation.\n\nFor instance, General Relativity supports a prediction that gravity propagates like a wave. This prediction can be quantified: a wave that might be observable by an incredibly delicate apparatus would be generated by, say, a supernova. Apparatus is built, the predicted phenomena is observed, and confidence in the theory increases accordingly. Often, predictions are not followed by observation. This unhappy situation is often followed by attempts to tweak the theory to make improved predictions that correspond to the (lack of) observation.\n\n2. **Experiment**, which is closely associated with the \"scientific method.\"\n\nThe hallmark of experiment is **intervention**. For instance, an important theory of plant growth involves a chemical called \"auxin.\" The theory holds that exposing plant tissue to light inhibits the generation of auxin. The auxin in turn, facilitates tissue growth and expansion. The result of the differential growth in on the lit and shaded side of a plant is growth toward the source of light. [Illustration](https://www.holganix.com/blog/what-are-plant-auxins-and-how-do-they-affect-plant-growth#:~:text=Auxins%20are%20a%20powerful%20growth,response%20to%20sunlight%20and%20gravity.).\n\nMuch of the experimentalist's intervention involves **standardizing the conditions** of the experiment. For instance, a plant growth study will provide a standard soil mixture, temperature, and watering amount for all the plants being studied.\n\nBut experiment always involves another aspect: one or more of the conditions is made to vary from one experimental unit to another. For instance, some plants might be lit from the North and others from the South. Seeing the same pattern of light-associated plant growth from both directions provides evidence that the Earth's magnetic field is not a factor in determining plant orientation.\n\n### Simulating experiment with DAGs\n\nExperiment is hard work and good experimental technique is paramount. Our goal here is to enhance the understanding of how experiment works generally. We're going to do this by simulation/gaming.\n\nWe'll start with a DAG that provides the rules of the game for how different factors are connected. We'll generate samples from the DAG and do some data analysis to illuminate the conditions in which data analysis can reveal---or not---the DAG mechanism. Then we'll simulate the intervention of experiment and see whether this can improve our ability to reveal the mechanism. (Of course, in real science, we don't have this ability to look immediately at the mechanism and see how it's structured. Our goal, however, is not to do science but to illustrate how scientific technique works.)\n\nConsider this DAG:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndag08\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nc ~ exo()\nx ~ c + exo()\ny ~ x + c + 3 + exo()\n```\n:::\n\n```{.r .cell-code}\ndag_draw(dag08)\n```\n\n::: {.cell-output-display}\n![](NTI-Lesson32_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nYou can see from the DAG formulas that the value of `y` increases or decreases exactly with the value of `x`. (The \"coefficient\" on `x` is 1.0)\n\nAs we've done before, we can simulate data from `dag08` and use regression to observe the relationship between `x` and `y`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSample <- sample(dag08, size=1000) # big, so that the noise is not a strong issue\nlm(y ~ x, data = Sample) %>% coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept)           x \n   2.951507    1.505652 \n```\n:::\n\n```{.r .cell-code}\nlm(y ~ x, data = Sample) %>% conf_interval()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"font-family: Courier; width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> .lwr </th>\n   <th style=\"text-align:right;\"> .upr </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2.876610 </td>\n   <td style=\"text-align:right;\"> 3.026404 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 1.453235 </td>\n   <td style=\"text-align:right;\"> 1.558069 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\nThe coefficient we observe is 1.5, not 1.0. So this approach to data analysis is not revealing the true mechanism. (It's legitimate to wonder whether 1.5 is really that different from 1.0, given the random factors involved in the mechanism. The confidence interval guides us here. By using `size=1000`, we narrowed the confidence interval to the extent that the interval on the observed coefficient has no overlap with the DAG specified coefficient of 1.0).\n\nIn [Lesson 27](Math300R-Lesson27.html) we discussed using **covariates** in a model in order to get a more accurate view of the true mechanism. This is a valuable technique, but using it requires that we know what are the covariates and can record their values in data. In this lesson, we'll imagine that we know how to do an experiment but don't have any reliable knowledge about covariates. \n\n### Intervening in a DAG\n\nCarrying out an experiment means **intervening** in the workings of the system. The intervention we're going to make in this example is to experimentally \"control\" or \"set\" the values of `x`. \n\nIn practice, this means we are creating a *new DAG* that represents our intervention in the system. \n\nThe `dag_intervene()` function is convenient for constructing the new DAG. The function works by letting us create a new formula for any variable in the DAG. For an ideal experiment, the new formula will just involve setting the values of `x` as we will.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndag08\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nc ~ exo()\nx ~ c + exo()\ny ~ x + c + 3 + exo()\n```\n:::\n\n```{.r .cell-code}\nexp08 <- dag_intervene(dag08, x ~ binom())\ndag_draw(exp08)\n```\n\n::: {.cell-output-display}\n![](NTI-Lesson32_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nNotice that the experimental intervention has **disconnected** all the inputs from `x`. \n\nSample data from `exp08` and do an appropriate data analysis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nExp_sample <- sample(exp08, size=1000)\nlm(y ~ x, data = Exp_sample) %>% conf_interval()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"font-family: Courier; width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> .lwr </th>\n   <th style=\"text-align:right;\"> .upr </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2.9772137 </td>\n   <td style=\"text-align:right;\"> 3.218490 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 0.7477415 </td>\n   <td style=\"text-align:right;\"> 1.092774 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\nThe confidence interval on the coefficient on `x` is 0.88 to 1.21, completely consistent with the (known) mechanism linking `x` and `y`. In other words, the experimental intervention correctly reveals the true mechanism.\n\n::: {.callout-note icon=false}\n## Covariates eat variance\n\nIf we have access to covariates, it's perfectly legitimate to include them in our models as explanatory variables. The advantage of doing so is that the amount of noise in `y` is reduced, because we are accounting for it by using the covariate.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ x + c, data = Exp_sample) %>% conf_interval()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"font-family: Courier; width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> .lwr </th>\n   <th style=\"text-align:right;\"> .upr </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 3.0245037 </td>\n   <td style=\"text-align:right;\"> 3.191886 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 0.7703293 </td>\n   <td style=\"text-align:right;\"> 1.009713 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> c </td>\n   <td style=\"text-align:right;\"> 0.9350248 </td>\n   <td style=\"text-align:right;\"> 1.053969 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\nThe confidence interval on the `x` coefficient is smaller: 0.92 to 1.17.\n\n:::\n\n### Imperfect experiment\n\nAn imperfect experiment, in the sense we mean here, is an experiment where the intervention attenuates the inputs to the variable of interest, but doesn't utterly eliminate them. Here's an example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp08b <- dag_intervene(dag08, x ~ c/2 + binom())\ndag_draw(exp08b)\n```\n\n::: {.cell-output-display}\n![](NTI-Lesson32_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nImperfect experiments are the rule in, say, clinical drug trials. For instance, people who are still sick may drop out of the trial or stop taking the assigned medicine.\n\nLet's look at the impact of the imperfection in `exp08b`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nExpb_sample <- sample(exp08b, size=1000)\nlm(y ~ x, data = Expb_sample) %>% conf_interval()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"font-family: Courier; width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> .lwr </th>\n   <th style=\"text-align:right;\"> .upr </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2.377253 </td>\n   <td style=\"text-align:right;\"> 2.557278 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 1.877846 </td>\n   <td style=\"text-align:right;\"> 2.090741 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\nThe confidence interval on the coefficient on `x` shows that we have not correctly revealed the mechanism of `x -> y` of the DAG.\n\nThere is a technique to improve results in experimental trial. We'll make yet another DAG, which will be the same as `exp08b` but where we record the experimenter's intended setting for the `x` variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp08c <- dag_make(\n  c ~ exo(),\n  z ~ binom(),\n  x ~ c/2 + z,\n  y ~ x + c + 3 + exo()\n)\ndag_draw(exp08c)\n```\n\n::: {.cell-output-display}\n![](NTI-Lesson32_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nLet's see what data analysis reveals for this DAG.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nExpc_sample <- sample(exp08c, size=1000)\nlm(y ~ x, data = Expc_sample) %>% conf_interval()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"font-family: Courier; width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> .lwr </th>\n   <th style=\"text-align:right;\"> .upr </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2.336625 </td>\n   <td style=\"text-align:right;\"> 2.515024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 1.907396 </td>\n   <td style=\"text-align:right;\"> 2.110798 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\nStill a wrong result. The improvement comes when we ignore the actual value of `x` and look at the relationship between the experimentally perfect `z` and `y`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ z, data = Expc_sample) %>% conf_interval()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"font-family: Courier; width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> .lwr </th>\n   <th style=\"text-align:right;\"> .upr </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2.6734582 </td>\n   <td style=\"text-align:right;\"> 2.990934 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> z </td>\n   <td style=\"text-align:right;\"> 0.9246418 </td>\n   <td style=\"text-align:right;\"> 1.369633 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\nBack on target! This method is called \"**intent to treat**\" because we are looking at how our experimental intentions play out to `y`. \n\n\n\n## Learning Checks\n\n\n\n\n\n\n\n\n\n## 32.1\n\n::: {.callout-note}\n## Solution\n\n:::\n\n--------\n\n\n## Documenting software\n\n  \n\n",
    "supporting": [
      "NTI-Lesson32_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}