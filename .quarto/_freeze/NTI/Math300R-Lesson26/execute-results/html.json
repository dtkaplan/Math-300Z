{
  "hash": "d7b8526c8a5cfc19aee81979589bbbe5",
  "result": {
    "markdown": "---\ntitle: \"Math 300R NTI Lesson 26\"\nsubtitle: \"Constructing a prediction interval\"\nauthor: \"Prof. Danny Kaplan\"\ndate: \"October 14, 2022\"\noutput:\n  html_document:\n    theme: lumen\n    toc: yes\n    toc_float: yes\n    css: NTI.css\n  pdf_document:\n    toc: yes\n---\n\n\n\n\n## Objectives\n\n\n\n\n\n\n\n\n26.1 In evaluating a model function, generate a prediction interval.\n\n26.2 Interpret prediction bands as a series of intervals, one for each value of the model input.\n\n26.3 Identify the two components that make up a prediction error, one that scales with $n$ and the other that doesn't.\n\n\n\n## Reading\n\nTBD\n\n\n## Lesson\n\n::: {.callout_note icon=false}\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simple correlation\ndag04 <- dag_make(x ~ eps(), y ~ 2*x + eps(0.5))\n# \"Error in variables\", that is, we don't measure x exactly.\ndag05 <- dag_make(.latent ~ eps(), x ~ .latent + eps(0.5), y ~ 2*.latent + eps(0.5))\n```\n:::\n\n:::\n\n\n* `mod_eval()` will create a prediction interval on each evaluation (if you ask it to).\n* Plotting out the prediction interval as a function of the input value gives a **prediction band**.\n\n\nHere's a demo which \n\ni. samples from the DAG and fits a model\nii. evaluates the model with test data, generating a prediction interval\niii. creates graphics to show the prediction band, the model function (in black), the \"true\" function (in green), and the actual output values from the DAG simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSamp <- sample(dag04, size=5)\nMod <- lm(y ~ x, data = Samp)\nTest <- mod_eval(Mod, data = sample(dag04, size=1000), interval=\"prediction\") \ngf_ribbon(upper + lower ~ x, data = Test) %>%\n  gf_point(model_output ~ x) %>%\n  gf_point(y ~ x, color=\"red\", alpha=0.3) %>%\n  gf_abline(intercept = ~ 0, slope = ~ 2, color=\"green\")\n```\n\n::: {.cell-output-display}\n![](Math300R-Lesson26_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n1. Make $n$ large (say, $n=500$) and show how the actual values fit nicely within the prediction band. \n    a. Run the simulation many times to verify that the band is right. \n    b. Use the vertical thickness of the band to estimate the amount of noise in $y$. (Remember, the band is $\\pm 2$ noise standard deviation.)\n    \n2. Make $n$ small (say, $n=5$) and show how the prediction band becomes wider and has a noticable curve. This reflects sampling variation in the fitted model.\n    a. Often, the prediction band will seem much larger than it needs to be. But ...\n    b. Occasionally the test data will lie substantially outside the prediction band.\n    c. It's only \"on average\" that the band is right.\n    \nA data scientist makes many prediction models over their career. Sometimes, the prediction interval will be much wider than the actual error. People will accuse you of being overly humble, suggesting that your skills are better than you take credit for. Other times, the prediction interval will be too small. Then you will be accused of over-confidence. But both these outcomes are a matter of luck: whether your sample happened to be a good representation of the actual mechanism or not. \n\nWhen the prediction bands are double-trumpet shaped, you are at risk of such \"over-confidence\" or \"under-confidence.\"\n\n\n\n\n\n\n\n\n::: {.callout-note icon=false}\n## Optional extension\n\nThis construction of prediction intervals is based on the idea that we measure the input variables exactly, but the output can involve some noise.\n\nIt can also happen that our measurement of the input quantities involves noise. This goes by the obscure name \"error in variables.\" `dag05` simulates the error-in-noise situation. Note that the estimated function is systematically flatter than the actual function (which you can read from the DAG).\n\nTo demonstrate this, insert `dag04` in place of `dag05` in the simulation, and repeat many times. \n\n## Learning Checks\n\n\n\n\n\n\n\n\n\nIdeas\n\n1. Construct prediction interval when evaluating a model function.\n2. Plot a prediction band.\n3. Check the consistency of the prediction band with the DAG mechanism for large $n$.\n    - Is the width right?\n    - Is the slope right?\n4. For small $n$ (say, $n=5$), how is the prediction band different than for large $n$?\n\n## 26.1\n\n\n::: {.callout-note}\n## Solution\n\n:::\n\n--------\n\n\n\n\n## Documenting software\n\n  \n\n",
    "supporting": [
      "Math300R-Lesson26_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}